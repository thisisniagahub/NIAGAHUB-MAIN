function e(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r={},a={},i=n.parcelRequire60cc;null==i&&((i=function(e){if(e in r)return r[e].exports;if(e in a){var t=a[e];delete a[e];var n={id:e,exports:{}};return r[e]=n,t.call(n.exports,n,n.exports),n.exports}var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){a[e]=t},n.parcelRequire60cc=i),i.register("3A0PR",(function(t,n){e(t.exports,"ERROR_NAME",(()=>a)),e(t.exports,"getZoom",(()=>l)),e(t.exports,"captureVisibleTab",(()=>c)),e(t.exports,"isCaptureVisibleTabQuotaError",(()=>d)),e(t.exports,"sendMessage",(()=>u)),e(t.exports,"getCurrentTab",(()=>p)),e(t.exports,"openInTabs",(()=>m));var r=i("5dZ7N");const a="ChromeTabsError",s=(0,r.genLastErrorFmt)(a),o=(0,r.genWrapError)(a),l=e=>o(chrome.tabs.getZoom(e),"getZoom"),c=(e,t)=>o(chrome.tabs.captureVisibleTab(e,t),"captureVisibleTab"),d=e=>e&&"object"==typeof e&&e.name===a&&"captureVisibleTab"===e.via&&e.message&&-1!==e.message.indexOf("MAX_CAPTURE_VISIBLE_TAB_CALLS_PER_SECOND"),u=(e,t,n)=>new Promise(((a,i)=>{chrome.tabs.sendMessage(e,t,n,(e=>{const t=(0,r.getLastError)();return t?i(s(t,"sendMessage")):a(e)}))})),p=()=>{return(e={active:!0,currentWindow:!0},o(chrome.tabs.query(e),"query")).then((e=>e[0]));var e},m=async(e,t)=>{let n,r=t.length;const a=i=>{if(i>=t.length)return t;let s=t[i],l=i===r-1;return e.incognito&&0===i?(c={url:s,incognito:!1,focused:l},o(chrome.windows.create(c),"windowsCreate")).then((e=>(n=e.id,a(i+1)))):(e=>o(chrome.tabs.create(e),"create"))({url:s,active:l,windowId:n,openerTabId:e.id,index:(e.incognito?0:e.index)+1+i}).then((e=>a(i+1)));var c};return a(0)}}));var s=i("1Tjc3");i("2q4iO");var o=i("aHNfr"),l=i("h4XuO"),c=i("6S5q7"),d=(s=i("1Tjc3"),i("cW7yT")),u=i("2q4iO"),p=i("83PZf"),m=i("dk7YQ"),h=i("2auQc"),f=i("jmw9X"),g=(i("h4XuO"),i("iMjBX"));var b=i("k24II"),v=i("aiU1O"),x=i("7i7LO");let y=null;const w=(e=!1)=>{if(null===y){const e=document.createElement("a");e.style.cssText="position: sticky;",y=-1!==e.style.position.indexOf("sticky")}return y&&e&&document.documentElement.classList.add("csspositionsticky"),y};var E=i("guJCW"),j=i("3ESIc"),k=(l=i("h4XuO"),i("2xkva")),S=(v=i("aiU1O"),i("03QYZ"));const T=(e,t)=>{let n,r,a=[];return e.forEach((e=>{e[t]!==r&&(void 0!==n&&a.push(n),r=e[t],n={key:r,vals:[]}),n.vals.push(e)})),n&&n.vals.length&&a.push(n),a},N=e=>{window.clearTimeout(N.timeoutId),(0,S.asArray)(document.querySelectorAll(".notif")).forEach((e=>e.classList.add("hide"))),(0,l.$)(e).classList.remove("hide"),N.timeoutId=window.setTimeout((()=>(0,l.$)(e).classList.add("hide")),2e3)};N.timeoutId=null;const C=async e=>{k.default.error("options error",e),await v.update(e);let t=R("div",{className:"error",textContent:"An error was encountered!  "}),n=(0,S.reportLink)(window.location.href,(0,S.errorToString)(e)),r=R("a",{className:"underline",target:"_blank",rel:"noopener noreferrer",href:n,textContent:"Report issue"});t.appendChild(r),O(),document.body.appendChild(t),window.scrollTo(0,0)},O=()=>{(0,S.asArray)(document.querySelectorAll("body > .error")).forEach((e=>{e.parentNode.removeChild(e)}))},R=(e,t)=>{let n=document.createElement(e);return t&&t.style&&(Object.assign(n.style,t.style),delete t.style),Object.assign(n,t),n},L=e=>{switch(e.type){case"checkbox":return e.checked;case"text":case"textarea":case"select-one":return e.value;default:throw new Error(`Unknown input type: ${e.type}`)}};s=i("1Tjc3"),d=i("cW7yT");var _=i("cAnjR");u=i("2q4iO");function I(){return I=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},I.apply(null,arguments)}function q(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}u=i("2q4iO"),u=i("2q4iO");var F=(u=i("2q4iO")).useLayoutEffect,A=function(e){var n=t(u).useRef(e);return F((function(){n.current=e})),n},M=(u=i("2q4iO"),function(e,t){"function"!=typeof e?e.current=t:e(t)}),z=function(e,n){var r=t(u).useRef();return t(u).useCallback((function(t){e.current=t,r.current&&M(r.current,null),r.current=n,n&&M(n,t)}),[n])},B={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},W=function(e){Object.keys(B).forEach((function(t){e.style.setProperty(t,B[t],"important")}))},P=null,$=function(e,t){var n=e.scrollHeight;return"border-box"===t.sizingStyle.boxSizing?n+t.borderSize:n-t.paddingSize};var U=function(){},H=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],D=!!document.documentElement.currentStyle,X=function(e){var t=window.getComputedStyle(e);if(null===t)return null;var n,r=(n=t,H.reduce((function(e,t){return e[t]=n[t],e}),{})),a=r.boxSizing;return""===a?null:(D&&"border-box"===a&&(r.width=parseFloat(r.width)+parseFloat(r.borderRightWidth)+parseFloat(r.borderLeftWidth)+parseFloat(r.paddingRight)+parseFloat(r.paddingLeft)+"px"),{sizingStyle:r,paddingSize:parseFloat(r.paddingBottom)+parseFloat(r.paddingTop),borderSize:parseFloat(r.borderBottomWidth)+parseFloat(r.borderTopWidth)})};function V(e,t,n){var r=A(n);u.useLayoutEffect((function(){var n=function(e){return r.current(e)};if(e)return e.addEventListener(t,n),function(){return e.removeEventListener(t,n)}}),[])}var Z=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],Q=function(e,t){var n=e.cacheMeasurements,r=e.maxRows,a=e.minRows,i=e.onChange,s=void 0===i?U:i,o=e.onHeightChange,l=void 0===o?U:o,c=q(e,Z),d=void 0!==c.value,p=u.useRef(null),m=z(p,t),h=u.useRef(0),f=u.useRef(),g=function(){var e=p.current,t=n&&f.current?f.current:X(e);if(t){f.current=t;var i=function(e,t,n,r){void 0===n&&(n=1),void 0===r&&(r=1/0),P||((P=document.createElement("textarea")).setAttribute("tabindex","-1"),P.setAttribute("aria-hidden","true"),W(P)),null===P.parentNode&&document.body.appendChild(P);var a=e.paddingSize,i=e.borderSize,s=e.sizingStyle,o=s.boxSizing;Object.keys(s).forEach((function(e){var t=e;P.style[t]=s[t]})),W(P),P.value=t;var l=$(P,e);P.value=t,l=$(P,e),P.value="x";var c=P.scrollHeight-a,d=c*n;"border-box"===o&&(d=d+a+i),l=Math.max(d,l);var u=c*r;return"border-box"===o&&(u=u+a+i),[l=Math.min(u,l),c]}(t,e.value||e.placeholder||"x",a,r),s=i[0],o=i[1];h.current!==s&&(h.current=s,e.style.setProperty("height",s+"px","important"),l(s,{rowHeight:o}))}};return u.useLayoutEffect(g),function(e,t){V(document.body,"reset",(function(n){e.current.form===n.target&&t(n)}))}(p,(function(){if(!d){var e=p.current,t=e.value;requestAnimationFrame((function(){t!==e.value&&g()}))}})),V(window,"resize",g),function(e){V(document.fonts,"loadingdone",e)}(g),u.createElement("textarea",I({},c,{onChange:function(e){d||g(),s(e)},ref:m}))},Y=u.forwardRef(Q),G=(s=i("1Tjc3"),u=i("2q4iO"),i("loK1Y"));const K=({text:e,cta1:t,cta1LinkFn:n,cta2:r,cta2LinkFn:a,isShow:i,setShow:o,setHide:l,userId:c})=>{const d="premium-cta",p=i?{onClick:l}:{onMouseEnter:o,onClick:o,onFocus:o};return(0,u.useEffect)((()=>{let e,t;return i&&(e=e=>{!!e.target.closest(`.${d}`)||l()},t=e=>{e.keyCode===G.ESC&&l()},document.documentElement.addEventListener("click",e,!1),document.documentElement.addEventListener("keyup",t,!1)),()=>{e&&document.documentElement.removeEventListener("click",e,!1),t&&document.documentElement.removeEventListener("keyup",t,!1)}}),[i,l]),(0,s.jsxs)("span",{className:d,children:[(0,s.jsx)("span",{tabIndex:"0",className:"premium-cta--icon",...p,children:"?"}),i&&(0,s.jsxs)("span",{className:"premium-cta--tooltip",children:[e,!1,t&&n&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("br",{}),(0,s.jsx)("a",{href:n(),children:t}),!c&&r&&a&&(0,s.jsxs)(s.Fragment,{children:[" or ",(0,s.jsx)("a",{href:a(),children:r})]})]})]})]})};K.displayName="PremiumCta";var J=K;const ee=({field:e,value:n,onChange:r,isSubOk:a,userId:i})=>{const o=e.premiumInfo,l=!a&&!!o;l&&(n=o.basicDefault);const[c,p]=(0,u.useState)(!1),m=()=>p(!0),h=e=>{const t=e.currentTarget,n=t.name;if(l)m();else{const e=L(t);r(n,e)}};let f;switch(e.type){case"bool":f=(0,s.jsx)("div",{className:"options-ctrl",children:(0,s.jsxs)("label",{children:[(0,s.jsx)("input",{className:"options-input",type:"checkbox",name:e.name,checked:n,onChange:h}),(0,s.jsx)("span",{className:"label-text",children:e.label})]})});break;case"text":f=(0,s.jsxs)("div",{className:"options-ctrl flex-wrapper",children:[(0,s.jsx)("label",{children:e.label}),"textarea"===e.width?(0,s.jsx)(Y,{className:"options-input",name:e.name,style:{resize:"none"},value:n,onChange:h}):(0,s.jsx)("input",{className:"options-input",type:"text",name:e.name,value:n,onChange:h,disabled:e.disabled})]});break;case"choice":f=(0,s.jsxs)("div",{className:"options-ctrl flex-wrapper",children:[(0,s.jsx)("label",{children:e.label}),(0,s.jsx)("select",{className:"options-input",name:e.name,value:n,onChange:h,children:e.convertedChoices.map((e=>(0,s.jsx)("option",{value:e.key,children:e.display||e.key},e.key)))})]});break;default:throw new Error(`unsupported type! ${e.type}`)}const g=(0,s.jsxs)("span",{className:"help",children:[e.help&&"function"==typeof e.help?e.help(n):e.help||"",l&&(0,s.jsxs)(s.Fragment,{children:[" ",(0,s.jsx)(J,{...o,isShow:c,setShow:m,setHide:()=>p(!1),userId:i})]}),(0,s.jsx)("span",{className:"msg"})]});return(0,s.jsxs)("div",{className:t(d)("options-elt",`type-${e.type}`),children:[f,g]})};ee.displayName="OptionField",ee.propTypes={field:t(_).shape({name:t(_).string.isRequired,type:t(_).oneOf(["choice","bool","text"]),group:t(_).string.isRequired,default:t(_).any,label:t(_).string.isRequired,help:t(_).string,validate:t(_).func,hidden:t(_).bool,premiumInfo:t(_).shape({text:t(_).string.isRequired,cta1:t(_).string,cta1LinkFn:t(_).func,cta2:t(_).string,cta2LinkFn:t(_).func,basicDefault:t(_).any.isRequired})}).isRequired,value:t(_).any,onChange:t(_).func.isRequired,isSubOk:t(_).bool.isRequired,userId:t(_).string};var te=ee,ne=(s=i("1Tjc3"),d=i("cW7yT"),u=i("2q4iO"),i("1BBN9")),re=(i("iMjBX"),k=i("2xkva"),i("830oE")),ae=(ne=i("1BBN9"),g=i("iMjBX"),i("a5i9T"));x=i("7i7LO");const ie=[{id:"downloads",perms:ne.PERMISSIONS.DOWNLOADS,name:(0,g.tr)("Downloads permission"),help_text:(0,g.tr)("This permission is required for the download buttons and the auto-download feature."),on_revoke:function(){x.default.remove("auto_dl2")}}];(0,ae.noIframes)()||ie.push({id:"iframe",perms:re.FRAME_PERMS,permsContains:re.FRAME_PERMS_CONTAINS,name:(0,g.tr)("iFrame permission"),help_html:(0,g.tr)("This permission is required in order to scroll the inner contents of $iframes$ or $framesets$.",null,[],{iframes:{content:'<a class="dim" target="_blank" rel="noopener noreferrer" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe">iframes</a>',example:"iframes"},framesets:{content:'<a class="dim" target="_blank" rel="noopener noreferrer" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/frameset">framesets</a>',example:"framesets"}})});s=i("1Tjc3");i("2q4iO");ne=i("1BBN9");const se=({tog:e,value:t,onChange:n})=>(0,s.jsxs)("div",{className:"perm-row cb-row",children:[(0,s.jsxs)("label",{children:[(0,s.jsx)("input",{className:"cb-input",type:"checkbox",name:e.id,checked:t||!1,disabled:void 0===t,onChange:t=>{t.currentTarget.checked?ne.request(e.perms).then((t=>{t?(N("notif-sav"),n(e.id,!0)):N("notif-err")})).catch(C):ne.remove(e.perms).then((t=>{t?(e.on_revoke&&e.on_revoke(),N("notif-sav"),n(e.id,!1)):N("notif-err")})).catch(C)}}),(0,s.jsx)("span",{className:"cb-text",children:e.name})]}),e.help_text?(0,s.jsx)("div",{className:"cb-help",children:e.help_text}):e.help_html?(0,s.jsx)("div",{className:"cb-help",dangerouslySetInnerHTML:{__html:e.help_html}}):null]});se.displayName="ToggleElt";var oe=se;const le=()=>{const[e,n]=(0,u.useState)({}),[r,a]=(0,u.useState)(!1),i=e=>n((t=>({...t,...e})));(0,u.useEffect)((()=>{ie.map((e=>{ne.contains(e.permsContains||e.perms).then((t=>{i({[e.id]:t})})).catch((e=>k.default.error(e)))}))}),[]);const o=(e,t)=>{i({[e]:t})};return(0,s.jsxs)("div",{className:"container",id:"perm-settings-container",children:[(0,s.jsx)("p",{children:(0,s.jsx)("a",{href:"",className:"perm-header dim",id:"perm-toggle",onClick:e=>{e.preventDefault(),a(!r)},children:(0,s.jsxs)("strong",{children:[(0,g.tr)("Permissions"),(0,s.jsx)("span",{className:t(d)("arrow",{"pe-7s-angle-down":!r,"pe-7s-angle-up":r})})]})})}),r&&(0,s.jsxs)("div",{id:"perm-content",children:[(0,s.jsx)("p",{children:(0,g.tr)("Any optional permissions that were previously granted will appear checked here. You can revoke them at any time. If they are needed again in the future, they will be re-requested.")}),ie.map((t=>(0,s.jsx)(oe,{tog:t,value:e[t.id],onChange:o},t.id)))]})]})};le.displayName="ToggleElts";var ce=le;const de=()=>{const[e,n]=(0,u.useState)(null),[r,a]=(0,u.useState)({}),[i,o]=(0,u.useState)(null),c=e=>n((t=>({...t,...e})));(0,u.useEffect)((()=>{b.default.pageview(),w(!0),(0,g.updateHtml)(),v.update(),Array.prototype.slice.call(document.querySelectorAll("a[data-href]")).forEach((e=>{e.href=e.dataset.href})),(0,l.$)("version-num").innerText=(0,j.getVersion)();const e=(0,h.makeLoginUrl)();l.$.findClass("account-url").forEach((t=>{t.setAttribute("href",e),t.style.display=""})),p.default.loginStateProm(!0).then((e=>{o(e)})),x.default.onUpdate((e=>{const t={};e.forEach((e=>{t[e]=x.default.state[e]})),c(t)})),x.default.load().then((e=>{n(e)}))}),[]),(0,u.useEffect)((()=>{if(f.REGISTER_SELF_URL){const e=document.getElementById("opts-menu-right");e||alert("Missing opts-menu-right wrapper!");const t=document.createElement("a");Object.assign(t.style,{display:"inline-block",marginRight:"20px",color:"#ef4444"}),t.textContent="Connect backend",t.target="_blank",t.href=`${f.REGISTER_SELF_URL}?id=${encodeURIComponent(chrome.runtime.id)}`,e.prepend(t),t.addEventListener("click",(e=>{e.shiftKey&&window.setTimeout((()=>{t.parentNode.removeChild(t)}))}),!1)}}),[]);const y=(e,t)=>{const n=x.default.getField(e);let i="";var s;n.process&&({val:t,msg:i}=n.process(t)),i&&r[e]!==i&&(s={[e]:i},a((e=>({...e,...s}))));(n.validate||E.PromiseTrue)(t).then((n=>n?(c({[e]:t}),x.default.set(e,t).then((()=>{N("notif-sav")}))):void 0)).catch((e=>{C(e)}))};if(!e)return(0,s.jsx)("div",{className:"container",id:"settings-container",children:(0,g.tr)("loading…")});const k=i&&i.userId||null,S=!!i&&"sub-ok"===i.subState,O=i&&i.store&&i.store.show_experimental||!1,R=T(Object.entries(x.default.fields).map((([t,n])=>(0,m.isFieldHidden)(n,S,e)?null:{...n,name:t})).filter((e=>e)),"group");return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"container",id:"settings-container",children:R.map((({key:n,vals:r},a)=>(0,s.jsxs)("div",{className:"options-group",children:[(0,s.jsx)("h3",{children:n}),(0,s.jsx)("div",{className:t(d)("options-list",{last:a===R.length-1}),children:r.map((t=>t.experimental&&!O?null:(0,s.jsx)(te,{field:t,value:e[t.name],onChange:y,userId:k,isSubOk:S},t.name)))})]},n)))}),(0,s.jsx)(ce,{})]})};de.displayName="App";var ue=de;!function(){const e=(0,c.getUrls)(),t=e.editor||e.capture||e.history;t&&l.$.findClass("back-button").forEach((e=>{-1===e.getAttribute("href").indexOf("?")&&(e.removeAttribute("data-href"),e.href=t)})),(0,c.setUrl)((0,l.$)("btn-settings"),e.options),(0,c.setUrl)((0,l.$)("btn-history"),e.history)}(),(0,o.render)((0,s.jsx)(ue,{}),document.getElementById("root"));
//# sourceMappingURL=options.6d0a8401.js.map
