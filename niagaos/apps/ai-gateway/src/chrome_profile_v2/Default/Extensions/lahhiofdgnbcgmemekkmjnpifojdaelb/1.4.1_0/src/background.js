(function(){"use strict";var Ct=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function kt(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var Pt={exports:{}};(function(l,_){(function(d,g){g(l)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:Ct,function(d){var g,y;if(!((y=(g=globalThis.chrome)==null?void 0:g.runtime)!=null&&y.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const f="The message port closed before a response was received.",c=w=>{const M={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(M).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class z extends WeakMap{constructor(m,T=void 0){super(T),this.createItem=m}get(m){return this.has(m)||this.set(m,this.createItem(m)),super.get(m)}}const L=p=>p&&typeof p=="object"&&typeof p.then=="function",k=(p,m)=>(...T)=>{w.runtime.lastError?p.reject(new Error(w.runtime.lastError.message)):m.singleCallbackArg||T.length<=1&&m.singleCallbackArg!==!1?p.resolve(T[0]):p.resolve(T)},x=p=>p==1?"argument":"arguments",S=(p,m)=>function(O,...U){if(U.length<m.minArgs)throw new Error(`Expected at least ${m.minArgs} ${x(m.minArgs)} for ${p}(), got ${U.length}`);if(U.length>m.maxArgs)throw new Error(`Expected at most ${m.maxArgs} ${x(m.maxArgs)} for ${p}(), got ${U.length}`);return new Promise((B,W)=>{if(m.fallbackToNoCallback)try{O[p](...U,k({resolve:B,reject:W},m))}catch(C){console.warn(`${p} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,C),O[p](...U),m.fallbackToNoCallback=!1,m.noCallback=!0,B()}else m.noCallback?(O[p](...U),B()):O[p](...U,k({resolve:B,reject:W},m))})},P=(p,m,T)=>new Proxy(m,{apply(O,U,B){return T.call(U,p,...B)}});let v=Function.call.bind(Object.prototype.hasOwnProperty);const a=(p,m={},T={})=>{let O=Object.create(null),U={has(W,C){return C in p||C in O},get(W,C,$){if(C in O)return O[C];if(!(C in p))return;let H=p[C];if(typeof H=="function")if(typeof m[C]=="function")H=P(p,p[C],m[C]);else if(v(T,C)){let tt=S(C,T[C]);H=P(p,p[C],tt)}else H=H.bind(p);else if(typeof H=="object"&&H!==null&&(v(m,C)||v(T,C)))H=a(H,m[C],T[C]);else if(v(T,"*"))H=a(H,m[C],T["*"]);else return Object.defineProperty(O,C,{configurable:!0,enumerable:!0,get(){return p[C]},set(tt){p[C]=tt}}),H;return O[C]=H,H},set(W,C,$,H){return C in O?O[C]=$:p[C]=$,!0},defineProperty(W,C,$){return Reflect.defineProperty(O,C,$)},deleteProperty(W,C){return Reflect.deleteProperty(O,C)}},B=Object.create(p);return new Proxy(B,U)},h=p=>({addListener(m,T,...O){m.addListener(p.get(T),...O)},hasListener(m,T){return m.hasListener(p.get(T))},removeListener(m,T){m.removeListener(p.get(T))}}),A=new z(p=>typeof p!="function"?p:function(T){const O=a(T,{},{getContent:{minArgs:0,maxArgs:0}});p(O)}),I=new z(p=>typeof p!="function"?p:function(T,O,U){let B=!1,W,C=new Promise(nt=>{W=function(Q){B=!0,nt(Q)}}),$;try{$=p(T,O,W)}catch(nt){$=Promise.reject(nt)}const H=$!==!0&&L($);if($!==!0&&!H&&!B)return!1;const tt=nt=>{nt.then(Q=>{U(Q)},Q=>{let ct;Q&&(Q instanceof Error||typeof Q.message=="string")?ct=Q.message:ct="An unexpected error occurred",U({__mozWebExtensionPolyfillReject__:!0,message:ct})}).catch(Q=>{console.error("Failed to send onMessage rejected reply",Q)})};return tt(H?$:C),!0}),E=({reject:p,resolve:m},T)=>{w.runtime.lastError?w.runtime.lastError.message===f?m():p(new Error(w.runtime.lastError.message)):T&&T.__mozWebExtensionPolyfillReject__?p(new Error(T.message)):m(T)},R=(p,m,T,...O)=>{if(O.length<m.minArgs)throw new Error(`Expected at least ${m.minArgs} ${x(m.minArgs)} for ${p}(), got ${O.length}`);if(O.length>m.maxArgs)throw new Error(`Expected at most ${m.maxArgs} ${x(m.maxArgs)} for ${p}(), got ${O.length}`);return new Promise((U,B)=>{const W=E.bind(null,{resolve:U,reject:B});O.push(W),T.sendMessage(...O)})},X={devtools:{network:{onRequestFinished:h(A)}},runtime:{onMessage:h(I),onMessageExternal:h(I),sendMessage:R.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:R.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},G={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return M.privacy={network:{"*":G},services:{"*":G},websites:{"*":G}},a(w,X,M)};d.exports=c(chrome)}else d.exports=globalThis.browser})})(Pt);var ee=Pt.exports;const q=kt(ee);function ne(l){return function(d){return{register(){l(async(g,y)=>{const f=d[g.type];if(f)try{return{success:!0,result:await f(g.input,y)}}catch(c){return{success:!1,error:c.message}}else return{success:!1,error:"No handler found"}})}}}}var Ot={exports:{}};/*!
 * Pusher JavaScript Library v7.0.6
 * https://pusher.com/
 *
 * Copyright 2020, Pusher
 * Released under the MIT licence.
 */(function(l,_){(function(g,y){l.exports=y()})(Ct,function(){return function(d){var g={};function y(f){if(g[f])return g[f].exports;var c=g[f]={i:f,l:!1,exports:{}};return d[f].call(c.exports,c,c.exports,y),c.l=!0,c.exports}return y.m=d,y.c=g,y.d=function(f,c,w){y.o(f,c)||Object.defineProperty(f,c,{enumerable:!0,get:w})},y.r=function(f){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(f,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(f,"__esModule",{value:!0})},y.t=function(f,c){if(c&1&&(f=y(f)),c&8||c&4&&typeof f=="object"&&f&&f.__esModule)return f;var w=Object.create(null);if(y.r(w),Object.defineProperty(w,"default",{enumerable:!0,value:f}),c&2&&typeof f!="string")for(var M in f)y.d(w,M,(function(z){return f[z]}).bind(null,M));return w},y.n=function(f){var c=f&&f.__esModule?function(){return f.default}:function(){return f};return y.d(c,"a",c),c},y.o=function(f,c){return Object.prototype.hasOwnProperty.call(f,c)},y.p="",y(y.s=2)}([function(d,g,y){var f=this&&this.__extends||function(){var v=function(a,h){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,I){A.__proto__=I}||function(A,I){for(var E in I)I.hasOwnProperty(E)&&(A[E]=I[E])},v(a,h)};return function(a,h){v(a,h);function A(){this.constructor=a}a.prototype=h===null?Object.create(h):(A.prototype=h.prototype,new A)}}();Object.defineProperty(g,"__esModule",{value:!0});var c=256,w=function(){function v(a){a===void 0&&(a="="),this._paddingCharacter=a}return v.prototype.encodedLength=function(a){return this._paddingCharacter?(a+2)/3*4|0:(a*8+5)/6|0},v.prototype.encode=function(a){for(var h="",A=0;A<a.length-2;A+=3){var I=a[A]<<16|a[A+1]<<8|a[A+2];h+=this._encodeByte(I>>>3*6&63),h+=this._encodeByte(I>>>2*6&63),h+=this._encodeByte(I>>>1*6&63),h+=this._encodeByte(I>>>0*6&63)}var E=a.length-A;if(E>0){var I=a[A]<<16|(E===2?a[A+1]<<8:0);h+=this._encodeByte(I>>>3*6&63),h+=this._encodeByte(I>>>2*6&63),E===2?h+=this._encodeByte(I>>>1*6&63):h+=this._paddingCharacter||"",h+=this._paddingCharacter||""}return h},v.prototype.maxDecodedLength=function(a){return this._paddingCharacter?a/4*3|0:(a*6+7)/8|0},v.prototype.decodedLength=function(a){return this.maxDecodedLength(a.length-this._getPaddingLength(a))},v.prototype.decode=function(a){if(a.length===0)return new Uint8Array(0);for(var h=this._getPaddingLength(a),A=a.length-h,I=new Uint8Array(this.maxDecodedLength(A)),E=0,R=0,X=0,G=0,p=0,m=0,T=0;R<A-4;R+=4)G=this._decodeChar(a.charCodeAt(R+0)),p=this._decodeChar(a.charCodeAt(R+1)),m=this._decodeChar(a.charCodeAt(R+2)),T=this._decodeChar(a.charCodeAt(R+3)),I[E++]=G<<2|p>>>4,I[E++]=p<<4|m>>>2,I[E++]=m<<6|T,X|=G&c,X|=p&c,X|=m&c,X|=T&c;if(R<A-1&&(G=this._decodeChar(a.charCodeAt(R)),p=this._decodeChar(a.charCodeAt(R+1)),I[E++]=G<<2|p>>>4,X|=G&c,X|=p&c),R<A-2&&(m=this._decodeChar(a.charCodeAt(R+2)),I[E++]=p<<4|m>>>2,X|=m&c),R<A-3&&(T=this._decodeChar(a.charCodeAt(R+3)),I[E++]=m<<6|T,X|=T&c),X!==0)throw new Error("Base64Coder: incorrect characters for decoding");return I},v.prototype._encodeByte=function(a){var h=a;return h+=65,h+=25-a>>>8&6,h+=51-a>>>8&-75,h+=61-a>>>8&-15,h+=62-a>>>8&3,String.fromCharCode(h)},v.prototype._decodeChar=function(a){var h=c;return h+=(42-a&a-44)>>>8&-c+a-43+62,h+=(46-a&a-48)>>>8&-c+a-47+63,h+=(47-a&a-58)>>>8&-c+a-48+52,h+=(64-a&a-91)>>>8&-c+a-65+0,h+=(96-a&a-123)>>>8&-c+a-97+26,h},v.prototype._getPaddingLength=function(a){var h=0;if(this._paddingCharacter){for(var A=a.length-1;A>=0&&a[A]===this._paddingCharacter;A--)h++;if(a.length<4||h>2)throw new Error("Base64Coder: incorrect padding")}return h},v}();g.Coder=w;var M=new w;function z(v){return M.encode(v)}g.encode=z;function L(v){return M.decode(v)}g.decode=L;var k=function(v){f(a,v);function a(){return v!==null&&v.apply(this,arguments)||this}return a.prototype._encodeByte=function(h){var A=h;return A+=65,A+=25-h>>>8&6,A+=51-h>>>8&-75,A+=61-h>>>8&-13,A+=62-h>>>8&49,String.fromCharCode(A)},a.prototype._decodeChar=function(h){var A=c;return A+=(44-h&h-46)>>>8&-c+h-45+62,A+=(94-h&h-96)>>>8&-c+h-95+63,A+=(47-h&h-58)>>>8&-c+h-48+52,A+=(64-h&h-91)>>>8&-c+h-65+0,A+=(96-h&h-123)>>>8&-c+h-97+26,A},a}(w);g.URLSafeCoder=k;var x=new k;function S(v){return x.encode(v)}g.encodeURLSafe=S;function P(v){return x.decode(v)}g.decodeURLSafe=P,g.encodedLength=function(v){return M.encodedLength(v)},g.maxDecodedLength=function(v){return M.maxDecodedLength(v)},g.decodedLength=function(v){return M.decodedLength(v)}},function(d,g,y){Object.defineProperty(g,"__esModule",{value:!0});var f="utf8: invalid string",c="utf8: invalid source encoding";function w(L){for(var k=new Uint8Array(M(L)),x=0,S=0;S<L.length;S++){var P=L.charCodeAt(S);P<128?k[x++]=P:P<2048?(k[x++]=192|P>>6,k[x++]=128|P&63):P<55296?(k[x++]=224|P>>12,k[x++]=128|P>>6&63,k[x++]=128|P&63):(S++,P=(P&1023)<<10,P|=L.charCodeAt(S)&1023,P+=65536,k[x++]=240|P>>18,k[x++]=128|P>>12&63,k[x++]=128|P>>6&63,k[x++]=128|P&63)}return k}g.encode=w;function M(L){for(var k=0,x=0;x<L.length;x++){var S=L.charCodeAt(x);if(S<128)k+=1;else if(S<2048)k+=2;else if(S<55296)k+=3;else if(S<=57343){if(x>=L.length-1)throw new Error(f);x++,k+=4}else throw new Error(f)}return k}g.encodedLength=M;function z(L){for(var k=[],x=0;x<L.length;x++){var S=L[x];if(S&128){var P=void 0;if(S<224){if(x>=L.length)throw new Error(c);var v=L[++x];if((v&192)!==128)throw new Error(c);S=(S&31)<<6|v&63,P=128}else if(S<240){if(x>=L.length-1)throw new Error(c);var v=L[++x],a=L[++x];if((v&192)!==128||(a&192)!==128)throw new Error(c);S=(S&15)<<12|(v&63)<<6|a&63,P=2048}else if(S<248){if(x>=L.length-2)throw new Error(c);var v=L[++x],a=L[++x],h=L[++x];if((v&192)!==128||(a&192)!==128||(h&192)!==128)throw new Error(c);S=(S&15)<<18|(v&63)<<12|(a&63)<<6|h&63,P=65536}else throw new Error(c);if(S<P||S>=55296&&S<=57343)throw new Error(c);if(S>=65536){if(S>1114111)throw new Error(c);S-=65536,k.push(String.fromCharCode(55296|S>>10)),S=56320|S&1023}}k.push(String.fromCharCode(S))}return k.join("")}g.decode=z},function(d,g,y){d.exports=y(3).default},function(d,g,y){y.r(g);function f(e){return k(z(e))}var c=String.fromCharCode,w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",M=function(e){var t=e.charCodeAt(0);return t<128?e:t<2048?c(192|t>>>6)+c(128|t&63):c(224|t>>>12&15)+c(128|t>>>6&63)+c(128|t&63)},z=function(e){return e.replace(/[^\x00-\x7F]/g,M)},L=function(e){var t=[0,2,1][e.length%3],n=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0),r=[w.charAt(n>>>18),w.charAt(n>>>12&63),t>=2?"=":w.charAt(n>>>6&63),t>=1?"=":w.charAt(n&63)];return r.join("")},k=self.btoa||function(e){return e.replace(/[\s\S]{1,3}/g,L)},x=function(){function e(t,n,r,i){var o=this;this.clear=n,this.timer=t(function(){o.timer&&(o.timer=i(o.timer))},r)}return e.prototype.isRunning=function(){return this.timer!==null},e.prototype.ensureAborted=function(){this.timer&&(this.clear(this.timer),this.timer=null)},e}(),S=x,P=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();function v(e){self.clearTimeout(e)}function a(e){self.clearInterval(e)}var h=function(e){P(t,e);function t(n,r){return e.call(this,setTimeout,v,n,function(i){return r(),null})||this}return t}(S),A=function(e){P(t,e);function t(n,r){return e.call(this,setInterval,a,n,function(i){return r(),i})||this}return t}(S),I={now:function(){return Date.now?Date.now():new Date().valueOf()},defer:function(e){return new h(0,e)},method:function(e){var t=Array.prototype.slice.call(arguments,1);return function(n){return n[e].apply(n,t.concat(arguments))}}},E=I;function R(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0;r<t.length;r++){var i=t[r];for(var o in i)i[o]&&i[o].constructor&&i[o].constructor===Object?e[o]=R(e[o]||{},i[o]):e[o]=i[o]}return e}function X(){for(var e=["Pusher"],t=0;t<arguments.length;t++)typeof arguments[t]=="string"?e.push(arguments[t]):e.push(lt(arguments[t]));return e.join(" : ")}function G(e,t){var n=Array.prototype.indexOf;if(e===null)return-1;if(n&&e.indexOf===n)return e.indexOf(t);for(var r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1}function p(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(e[n],n,e)}function m(e){var t=[];return p(e,function(n,r){t.push(r)}),t}function T(e){var t=[];return p(e,function(n){t.push(n)}),t}function O(e,t,n){for(var r=0;r<e.length;r++)t.call(n||self,e[r],r,e)}function U(e,t){for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r,e,n));return n}function B(e,t){var n={};return p(e,function(r,i){n[i]=t(r)}),n}function W(e,t){t=t||function(i){return!!i};for(var n=[],r=0;r<e.length;r++)t(e[r],r,e,n)&&n.push(e[r]);return n}function C(e,t){var n={};return p(e,function(r,i){(t&&t(r,i,e,n)||r)&&(n[i]=r)}),n}function $(e){var t=[];return p(e,function(n,r){t.push([r,n])}),t}function H(e,t){for(var n=0;n<e.length;n++)if(t(e[n],n,e))return!0;return!1}function tt(e,t){for(var n=0;n<e.length;n++)if(!t(e[n],n,e))return!1;return!0}function nt(e){return B(e,function(t){return typeof t=="object"&&(t=lt(t)),encodeURIComponent(f(t.toString()))})}function Q(e){var t=C(e,function(r){return r!==void 0}),n=U($(nt(t)),E.method("join","=")).join("&");return n}function ct(e){var t=[],n=[];return function r(i,o){var s,u,b;switch(typeof i){case"object":if(!i)return null;for(s=0;s<t.length;s+=1)if(t[s]===i)return{$ref:n[s]};if(t.push(i),n.push(o),Object.prototype.toString.apply(i)==="[object Array]")for(b=[],s=0;s<i.length;s+=1)b[s]=r(i[s],o+"["+s+"]");else{b={};for(u in i)Object.prototype.hasOwnProperty.call(i,u)&&(b[u]=r(i[u],o+"["+JSON.stringify(u)+"]"))}return b;case"number":case"string":case"boolean":return i}}(e,"$")}function lt(e){try{return JSON.stringify(e)}catch{return JSON.stringify(ct(e))}}var me={VERSION:"7.0.6",PROTOCOL:7,wsPort:80,wssPort:443,wsPath:"",httpHost:"sockjs.pusher.com",httpPort:80,httpsPort:443,httpPath:"/pusher",stats_host:"stats.pusher.com",authEndpoint:"/pusher/auth",authTransport:"ajax",activityTimeout:12e4,pongTimeout:3e4,unavailableTimeout:1e4,cluster:"mt1",cdn_http:"http://js.pusher.com",cdn_https:"https://js.pusher.com",dependency_suffix:""},F=me;function Et(e,t,n){var r=e+(t.useTLS?"s":""),i=t.useTLS?t.hostTLS:t.hostNonTLS;return r+"://"+i+n}function Rt(e,t){var n="/app/"+e,r="?protocol="+F.PROTOCOL+"&client=js&version="+F.VERSION+(t?"&"+t:"");return n+r}var ye={getInitial:function(e,t){var n=(t.httpPath||"")+Rt(e,"flash=false");return Et("ws",t,n)}},ve={getInitial:function(e,t){var n=(t.httpPath||"/pusher")+Rt(e);return Et("http",t,n)}},be=function(){function e(){this._callbacks={}}return e.prototype.get=function(t){return this._callbacks[dt(t)]},e.prototype.add=function(t,n,r){var i=dt(t);this._callbacks[i]=this._callbacks[i]||[],this._callbacks[i].push({fn:n,context:r})},e.prototype.remove=function(t,n,r){if(!t&&!n&&!r){this._callbacks={};return}var i=t?[dt(t)]:m(this._callbacks);n||r?this.removeCallback(i,n,r):this.removeAllCallbacks(i)},e.prototype.removeCallback=function(t,n,r){O(t,function(i){this._callbacks[i]=W(this._callbacks[i]||[],function(o){return n&&n!==o.fn||r&&r!==o.context}),this._callbacks[i].length===0&&delete this._callbacks[i]},this)},e.prototype.removeAllCallbacks=function(t){O(t,function(n){delete this._callbacks[n]},this)},e}(),_e=be;function dt(e){return"_"+e}var Ae=function(){function e(t){this.callbacks=new _e,this.global_callbacks=[],this.failThrough=t}return e.prototype.bind=function(t,n,r){return this.callbacks.add(t,n,r),this},e.prototype.bind_global=function(t){return this.global_callbacks.push(t),this},e.prototype.unbind=function(t,n,r){return this.callbacks.remove(t,n,r),this},e.prototype.unbind_global=function(t){return t?(this.global_callbacks=W(this.global_callbacks||[],function(n){return n!==t}),this):(this.global_callbacks=[],this)},e.prototype.unbind_all=function(){return this.unbind(),this.unbind_global(),this},e.prototype.emit=function(t,n,r){for(var i=0;i<this.global_callbacks.length;i++)this.global_callbacks[i](t,n);var o=this.callbacks.get(t),s=[];if(r?s.push(n,r):n&&s.push(n),o&&o.length>0)for(var i=0;i<o.length;i++)o[i].fn.apply(o[i].context||self,s);else this.failThrough&&this.failThrough(t,n);return this},e}(),rt=Ae,xe=function(){function e(){this.globalLog=function(t){self.console&&self.console.log&&self.console.log(t)}}return e.prototype.debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.log(this.globalLog,t)},e.prototype.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.log(this.globalLogWarn,t)},e.prototype.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.log(this.globalLogError,t)},e.prototype.globalLogWarn=function(t){self.console&&self.console.warn?self.console.warn(t):this.globalLog(t)},e.prototype.globalLogError=function(t){self.console&&self.console.error?self.console.error(t):this.globalLogWarn(t)},e.prototype.log=function(t){var n=X.apply(this,arguments);if(wt.log)wt.log(n);else if(wt.logToConsole){var r=t.bind(this);r(n)}},e}(),D=new xe,we=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Se=function(e){we(t,e);function t(n,r,i,o,s){var u=e.call(this)||this;return u.initialize=j.transportConnectionInitializer,u.hooks=n,u.name=r,u.priority=i,u.key=o,u.options=s,u.state="new",u.timeline=s.timeline,u.activityTimeout=s.activityTimeout,u.id=u.timeline.generateUniqueID(),u}return t.prototype.handlesActivityChecks=function(){return!!this.hooks.handlesActivityChecks},t.prototype.supportsPing=function(){return!!this.hooks.supportsPing},t.prototype.connect=function(){var n=this;if(this.socket||this.state!=="initialized")return!1;var r=this.hooks.urls.getInitial(this.key,this.options);try{this.socket=this.hooks.getSocket(r,this.options)}catch(i){return E.defer(function(){n.onError(i),n.changeState("closed")}),!1}return this.bindListeners(),D.debug("Connecting",{transport:this.name,url:r}),this.changeState("connecting"),!0},t.prototype.close=function(){return this.socket?(this.socket.close(),!0):!1},t.prototype.send=function(n){var r=this;return this.state==="open"?(E.defer(function(){r.socket&&r.socket.send(n)}),!0):!1},t.prototype.ping=function(){this.state==="open"&&this.supportsPing()&&this.socket.ping()},t.prototype.onOpen=function(){this.hooks.beforeOpen&&this.hooks.beforeOpen(this.socket,this.hooks.urls.getPath(this.key,this.options)),this.changeState("open"),this.socket.onopen=void 0},t.prototype.onError=function(n){this.emit("error",{type:"WebSocketError",error:n}),this.timeline.error(this.buildTimelineMessage({error:n.toString()}))},t.prototype.onClose=function(n){n?this.changeState("closed",{code:n.code,reason:n.reason,wasClean:n.wasClean}):this.changeState("closed"),this.unbindListeners(),this.socket=void 0},t.prototype.onMessage=function(n){this.emit("message",n)},t.prototype.onActivity=function(){this.emit("activity")},t.prototype.bindListeners=function(){var n=this;this.socket.onopen=function(){n.onOpen()},this.socket.onerror=function(r){n.onError(r)},this.socket.onclose=function(r){n.onClose(r)},this.socket.onmessage=function(r){n.onMessage(r)},this.supportsPing()&&(this.socket.onactivity=function(){n.onActivity()})},t.prototype.unbindListeners=function(){this.socket&&(this.socket.onopen=void 0,this.socket.onerror=void 0,this.socket.onclose=void 0,this.socket.onmessage=void 0,this.supportsPing()&&(this.socket.onactivity=void 0))},t.prototype.changeState=function(n,r){this.state=n,this.timeline.info(this.buildTimelineMessage({state:n,params:r})),this.emit(n,r)},t.prototype.buildTimelineMessage=function(n){return R({cid:this.id},n)},t}(rt),Te=Se,Ce=function(){function e(t){this.hooks=t}return e.prototype.isSupported=function(t){return this.hooks.isSupported(t)},e.prototype.createConnection=function(t,n,r,i){return new Te(this.hooks,t,n,r,i)},e}(),gt=Ce,ke=new gt({urls:ye,handlesActivityChecks:!1,supportsPing:!1,isInitialized:function(){return!!j.getWebSocketAPI()},isSupported:function(){return!!j.getWebSocketAPI()},getSocket:function(e){return j.createWebSocket(e)}}),jt={urls:ve,handlesActivityChecks:!1,supportsPing:!0,isInitialized:function(){return!0}},Pe=R({getSocket:function(e){return j.HTTPFactory.createStreamingSocket(e)}},jt),Oe=R({getSocket:function(e){return j.HTTPFactory.createPollingSocket(e)}},jt),It={isSupported:function(){return j.isXHRSupported()}},Le=new gt(R({},Pe,It)),Ee=new gt(R({},Oe,It)),Re={ws:ke,xhr_streaming:Le,xhr_polling:Ee},Mt=Re,je=function(){function e(t,n,r){this.manager=t,this.transport=n,this.minPingDelay=r.minPingDelay,this.maxPingDelay=r.maxPingDelay,this.pingDelay=void 0}return e.prototype.createConnection=function(t,n,r,i){var o=this;i=R({},i,{activityTimeout:this.pingDelay});var s=this.transport.createConnection(t,n,r,i),u=null,b=function(){s.unbind("open",b),s.bind("closed",N),u=E.now()},N=function(J){if(s.unbind("closed",N),J.code===1002||J.code===1003)o.manager.reportDeath();else if(!J.wasClean&&u){var K=E.now()-u;K<2*o.maxPingDelay&&(o.manager.reportDeath(),o.pingDelay=Math.max(K/2,o.minPingDelay))}};return s.bind("open",b),s},e.prototype.isSupported=function(t){return this.manager.isAlive()&&this.transport.isSupported(t)},e}(),Ie=je,Nt={decodeMessage:function(e){try{var t=JSON.parse(e.data),n=t.data;if(typeof n=="string")try{n=JSON.parse(t.data)}catch{}var r={event:t.event,channel:t.channel,data:n};return t.user_id&&(r.user_id=t.user_id),r}catch(i){throw{type:"MessageParseError",error:i,data:e.data}}},encodeMessage:function(e){return JSON.stringify(e)},processHandshake:function(e){var t=Nt.decodeMessage(e);if(t.event==="pusher:connection_established"){if(!t.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",id:t.data.socket_id,activityTimeout:t.data.activity_timeout*1e3}}else{if(t.event==="pusher:error")return{action:this.getCloseAction(t.data),error:this.getCloseError(t.data)};throw"Invalid handshake"}},getCloseAction:function(e){return e.code<4e3?e.code>=1002&&e.code<=1004?"backoff":null:e.code===4e3?"tls_only":e.code<4100?"refused":e.code<4200?"backoff":e.code<4300?"retry":"refused"},getCloseError:function(e){return e.code!==1e3&&e.code!==1001?{type:"PusherError",data:{code:e.code,message:e.reason||e.message}}:null}},it=Nt,Me=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ne=function(e){Me(t,e);function t(n,r){var i=e.call(this)||this;return i.id=n,i.transport=r,i.activityTimeout=r.activityTimeout,i.bindListeners(),i}return t.prototype.handlesActivityChecks=function(){return this.transport.handlesActivityChecks()},t.prototype.send=function(n){return this.transport.send(n)},t.prototype.send_event=function(n,r,i){var o={event:n,data:r};return i&&(o.channel=i),D.debug("Event sent",o),this.send(it.encodeMessage(o))},t.prototype.ping=function(){this.transport.supportsPing()?this.transport.ping():this.send_event("pusher:ping",{})},t.prototype.close=function(){this.transport.close()},t.prototype.bindListeners=function(){var n=this,r={message:function(o){var s;try{s=it.decodeMessage(o)}catch(u){n.emit("error",{type:"MessageParseError",error:u,data:o.data})}if(s!==void 0){switch(D.debug("Event recd",s),s.event){case"pusher:error":n.emit("error",{type:"PusherError",data:s.data});break;case"pusher:ping":n.emit("ping");break;case"pusher:pong":n.emit("pong");break}n.emit("message",s)}},activity:function(){n.emit("activity")},error:function(o){n.emit("error",o)},closed:function(o){i(),o&&o.code&&n.handleCloseEvent(o),n.transport=null,n.emit("closed")}},i=function(){p(r,function(o,s){n.transport.unbind(s,o)})};p(r,function(o,s){n.transport.bind(s,o)})},t.prototype.handleCloseEvent=function(n){var r=it.getCloseAction(n),i=it.getCloseError(n);i&&this.emit("error",i),r&&this.emit(r,{action:r,error:i})},t}(rt),He=Ne,Ue=function(){function e(t,n){this.transport=t,this.callback=n,this.bindListeners()}return e.prototype.close=function(){this.unbindListeners(),this.transport.close()},e.prototype.bindListeners=function(){var t=this;this.onMessage=function(n){t.unbindListeners();var r;try{r=it.processHandshake(n)}catch(i){t.finish("error",{error:i}),t.transport.close();return}r.action==="connected"?t.finish("connected",{connection:new He(r.id,t.transport),activityTimeout:r.activityTimeout}):(t.finish(r.action,{error:r.error}),t.transport.close())},this.onClosed=function(n){t.unbindListeners();var r=it.getCloseAction(n)||"backoff",i=it.getCloseError(n);t.finish(r,{error:i})},this.transport.bind("message",this.onMessage),this.transport.bind("closed",this.onClosed)},e.prototype.unbindListeners=function(){this.transport.unbind("message",this.onMessage),this.transport.unbind("closed",this.onClosed)},e.prototype.finish=function(t,n){this.callback(R({transport:this.transport,action:t},n))},e}(),De=Ue,Fe=function(){function e(t,n){this.channel=t;var r=n.authTransport;if(typeof j.getAuthorizers()[r]>"u")throw"'"+r+"' is not a recognized auth transport";this.type=r,this.options=n,this.authOptions=n.auth||{}}return e.prototype.composeQuery=function(t){var n="socket_id="+encodeURIComponent(t)+"&channel_name="+encodeURIComponent(this.channel.name);for(var r in this.authOptions.params)n+="&"+encodeURIComponent(r)+"="+encodeURIComponent(this.authOptions.params[r]);return n},e.prototype.authorize=function(t,n){e.authorizers=e.authorizers||j.getAuthorizers(),e.authorizers[this.type].call(this,j,t,n)},e}(),ze=Fe,qe=function(){function e(t,n){this.timeline=t,this.options=n||{}}return e.prototype.send=function(t,n){this.timeline.isEmpty()||this.timeline.send(j.TimelineTransport.getAgent(this,t),n)},e}(),Be=qe,et=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),We=function(e){et(t,e);function t(n){var r=this.constructor,i=e.call(this,n)||this;return Object.setPrototypeOf(i,r.prototype),i}return t}(Error);(function(e){et(t,e);function t(n){var r=this.constructor,i=e.call(this,n)||this;return Object.setPrototypeOf(i,r.prototype),i}return t})(Error);var $e=function(e){et(t,e);function t(n){var r=this.constructor,i=e.call(this,n)||this;return Object.setPrototypeOf(i,r.prototype),i}return t}(Error),Je=function(e){et(t,e);function t(n){var r=this.constructor,i=e.call(this,n)||this;return Object.setPrototypeOf(i,r.prototype),i}return t}(Error),Ht=function(e){et(t,e);function t(n){var r=this.constructor,i=e.call(this,n)||this;return Object.setPrototypeOf(i,r.prototype),i}return t}(Error),Xe=function(e){et(t,e);function t(n){var r=this.constructor,i=e.call(this,n)||this;return Object.setPrototypeOf(i,r.prototype),i}return t}(Error),Ut=function(e){et(t,e);function t(n){var r=this.constructor,i=e.call(this,n)||this;return Object.setPrototypeOf(i,r.prototype),i}return t}(Error),mt=function(e){et(t,e);function t(n,r){var i=this.constructor,o=e.call(this,r)||this;return o.status=n,Object.setPrototypeOf(o,i.prototype),o}return t}(Error),Dt={baseUrl:"https://pusher.com",urls:{authenticationEndpoint:{path:"/docs/authenticating_users"},javascriptQuickStart:{path:"/docs/javascript_quick_start"},triggeringClientEvents:{path:"/docs/client_api_guide/client_events#trigger-events"},encryptedChannelSupport:{fullUrl:"https://github.com/pusher/pusher-js/tree/cc491015371a4bde5743d1c87a0fbac0feb53195#encrypted-channel-support"}}},Ge=function(e){var t="See:",n=Dt.urls[e];if(!n)return"";var r;return n.fullUrl?r=n.fullUrl:n.path&&(r=Dt.baseUrl+n.path),r?t+" "+r:""},ht={buildLogSuffix:Ge},Ve=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ke=function(e){Ve(t,e);function t(n,r){var i=e.call(this,function(o,s){D.debug("No callbacks on "+n+" for "+o)})||this;return i.name=n,i.pusher=r,i.subscribed=!1,i.subscriptionPending=!1,i.subscriptionCancelled=!1,i}return t.prototype.authorize=function(n,r){return r(null,{auth:""})},t.prototype.trigger=function(n,r){if(n.indexOf("client-")!==0)throw new We("Event '"+n+"' does not start with 'client-'");if(!this.subscribed){var i=ht.buildLogSuffix("triggeringClientEvents");D.warn("Client event triggered before channel 'subscription_succeeded' event . "+i)}return this.pusher.send_event(n,r,this.name)},t.prototype.disconnect=function(){this.subscribed=!1,this.subscriptionPending=!1},t.prototype.handleEvent=function(n){var r=n.event,i=n.data;if(r==="pusher_internal:subscription_succeeded")this.handleSubscriptionSucceededEvent(n);else if(r.indexOf("pusher_internal:")!==0){var o={};this.emit(r,i,o)}},t.prototype.handleSubscriptionSucceededEvent=function(n){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):this.emit("pusher:subscription_succeeded",n.data)},t.prototype.subscribe=function(){var n=this;this.subscribed||(this.subscriptionPending=!0,this.subscriptionCancelled=!1,this.authorize(this.pusher.connection.socket_id,function(r,i){r?(n.subscriptionPending=!1,D.error(r.toString()),n.emit("pusher:subscription_error",Object.assign({},{type:"AuthError",error:r.message},r instanceof mt?{status:r.status}:{}))):n.pusher.send_event("pusher:subscribe",{auth:i.auth,channel_data:i.channel_data,channel:n.name})}))},t.prototype.unsubscribe=function(){this.subscribed=!1,this.pusher.send_event("pusher:unsubscribe",{channel:this.name})},t.prototype.cancelSubscription=function(){this.subscriptionCancelled=!0},t.prototype.reinstateSubscription=function(){this.subscriptionCancelled=!1},t}(rt),Ft=Ke,Qe=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ze=function(e){Qe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.authorize=function(n,r){var i=Z.createAuthorizer(this,this.pusher.config);return i.authorize(n,r)},t}(Ft),yt=Ze,Ye=function(){function e(){this.reset()}return e.prototype.get=function(t){return Object.prototype.hasOwnProperty.call(this.members,t)?{id:t,info:this.members[t]}:null},e.prototype.each=function(t){var n=this;p(this.members,function(r,i){t(n.get(i))})},e.prototype.setMyID=function(t){this.myID=t},e.prototype.onSubscription=function(t){this.members=t.presence.hash,this.count=t.presence.count,this.me=this.get(this.myID)},e.prototype.addMember=function(t){return this.get(t.user_id)===null&&this.count++,this.members[t.user_id]=t.user_info,this.get(t.user_id)},e.prototype.removeMember=function(t){var n=this.get(t.user_id);return n&&(delete this.members[t.user_id],this.count--),n},e.prototype.reset=function(){this.members={},this.count=0,this.myID=null,this.me=null},e}(),tn=Ye,en=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),nn=function(e){en(t,e);function t(n,r){var i=e.call(this,n,r)||this;return i.members=new tn,i}return t.prototype.authorize=function(n,r){var i=this;e.prototype.authorize.call(this,n,function(o,s){if(!o){if(s=s,s.channel_data===void 0){var u=ht.buildLogSuffix("authenticationEndpoint");D.error("Invalid auth response for channel '"+i.name+"',"+("expected 'channel_data' field. "+u)),r("Invalid auth response");return}var b=JSON.parse(s.channel_data);i.members.setMyID(b.user_id)}r(o,s)})},t.prototype.handleEvent=function(n){var r=n.event;if(r.indexOf("pusher_internal:")===0)this.handleInternalEvent(n);else{var i=n.data,o={};n.user_id&&(o.user_id=n.user_id),this.emit(r,i,o)}},t.prototype.handleInternalEvent=function(n){var r=n.event,i=n.data;switch(r){case"pusher_internal:subscription_succeeded":this.handleSubscriptionSucceededEvent(n);break;case"pusher_internal:member_added":var o=this.members.addMember(i);this.emit("pusher:member_added",o);break;case"pusher_internal:member_removed":var s=this.members.removeMember(i);s&&this.emit("pusher:member_removed",s);break}},t.prototype.handleSubscriptionSucceededEvent=function(n){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):(this.members.onSubscription(n.data),this.emit("pusher:subscription_succeeded",this.members))},t.prototype.disconnect=function(){this.members.reset(),e.prototype.disconnect.call(this)},t}(yt),rn=nn,on=y(1),vt=y(0),sn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),an=function(e){sn(t,e);function t(n,r,i){var o=e.call(this,n,r)||this;return o.key=null,o.nacl=i,o}return t.prototype.authorize=function(n,r){var i=this;e.prototype.authorize.call(this,n,function(o,s){if(o){r(o,s);return}var u=s.shared_secret;if(!u){r(new Error("No shared_secret key in auth payload for encrypted channel: "+i.name),null);return}i.key=Object(vt.decode)(u),delete s.shared_secret,r(null,s)})},t.prototype.trigger=function(n,r){throw new Ht("Client events are not currently supported for encrypted channels")},t.prototype.handleEvent=function(n){var r=n.event,i=n.data;if(r.indexOf("pusher_internal:")===0||r.indexOf("pusher:")===0){e.prototype.handleEvent.call(this,n);return}this.handleEncryptedEvent(r,i)},t.prototype.handleEncryptedEvent=function(n,r){var i=this;if(!this.key){D.debug("Received encrypted event before key has been retrieved from the authEndpoint");return}if(!r.ciphertext||!r.nonce){D.error("Unexpected format for encrypted event, expected object with `ciphertext` and `nonce` fields, got: "+r);return}var o=Object(vt.decode)(r.ciphertext);if(o.length<this.nacl.secretbox.overheadLength){D.error("Expected encrypted event ciphertext length to be "+this.nacl.secretbox.overheadLength+", got: "+o.length);return}var s=Object(vt.decode)(r.nonce);if(s.length<this.nacl.secretbox.nonceLength){D.error("Expected encrypted event nonce length to be "+this.nacl.secretbox.nonceLength+", got: "+s.length);return}var u=this.nacl.secretbox.open(o,s,this.key);if(u===null){D.debug("Failed to decrypt an event, probably because it was encrypted with a different key. Fetching a new key from the authEndpoint..."),this.authorize(this.pusher.connection.socket_id,function(b,N){if(b){D.error("Failed to make a request to the authEndpoint: "+N+". Unable to fetch new key, so dropping encrypted event");return}if(u=i.nacl.secretbox.open(o,s,i.key),u===null){D.error("Failed to decrypt event with new key. Dropping encrypted event");return}i.emit(n,i.getDataToEmit(u))});return}this.emit(n,this.getDataToEmit(u))},t.prototype.getDataToEmit=function(n){var r=Object(on.decode)(n);try{return JSON.parse(r)}catch{return r}},t}(yt),cn=an,un=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),ln=function(e){un(t,e);function t(n,r){var i=e.call(this)||this;i.state="initialized",i.connection=null,i.key=n,i.options=r,i.timeline=i.options.timeline,i.usingTLS=i.options.useTLS,i.errorCallbacks=i.buildErrorCallbacks(),i.connectionCallbacks=i.buildConnectionCallbacks(i.errorCallbacks),i.handshakeCallbacks=i.buildHandshakeCallbacks(i.errorCallbacks);var o=j.getNetwork();return o.bind("online",function(){i.timeline.info({netinfo:"online"}),(i.state==="connecting"||i.state==="unavailable")&&i.retryIn(0)}),o.bind("offline",function(){i.timeline.info({netinfo:"offline"}),i.connection&&i.sendActivityCheck()}),i.updateStrategy(),i}return t.prototype.connect=function(){if(!(this.connection||this.runner)){if(!this.strategy.isSupported()){this.updateState("failed");return}this.updateState("connecting"),this.startConnecting(),this.setUnavailableTimer()}},t.prototype.send=function(n){return this.connection?this.connection.send(n):!1},t.prototype.send_event=function(n,r,i){return this.connection?this.connection.send_event(n,r,i):!1},t.prototype.disconnect=function(){this.disconnectInternally(),this.updateState("disconnected")},t.prototype.isUsingTLS=function(){return this.usingTLS},t.prototype.startConnecting=function(){var n=this,r=function(i,o){i?n.runner=n.strategy.connect(0,r):o.action==="error"?(n.emit("error",{type:"HandshakeError",error:o.error}),n.timeline.error({handshakeError:o.error})):(n.abortConnecting(),n.handshakeCallbacks[o.action](o))};this.runner=this.strategy.connect(0,r)},t.prototype.abortConnecting=function(){this.runner&&(this.runner.abort(),this.runner=null)},t.prototype.disconnectInternally=function(){if(this.abortConnecting(),this.clearRetryTimer(),this.clearUnavailableTimer(),this.connection){var n=this.abandonConnection();n.close()}},t.prototype.updateStrategy=function(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,useTLS:this.usingTLS})},t.prototype.retryIn=function(n){var r=this;this.timeline.info({action:"retry",delay:n}),n>0&&this.emit("connecting_in",Math.round(n/1e3)),this.retryTimer=new h(n||0,function(){r.disconnectInternally(),r.connect()})},t.prototype.clearRetryTimer=function(){this.retryTimer&&(this.retryTimer.ensureAborted(),this.retryTimer=null)},t.prototype.setUnavailableTimer=function(){var n=this;this.unavailableTimer=new h(this.options.unavailableTimeout,function(){n.updateState("unavailable")})},t.prototype.clearUnavailableTimer=function(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()},t.prototype.sendActivityCheck=function(){var n=this;this.stopActivityCheck(),this.connection.ping(),this.activityTimer=new h(this.options.pongTimeout,function(){n.timeline.error({pong_timed_out:n.options.pongTimeout}),n.retryIn(0)})},t.prototype.resetActivityCheck=function(){var n=this;this.stopActivityCheck(),this.connection&&!this.connection.handlesActivityChecks()&&(this.activityTimer=new h(this.activityTimeout,function(){n.sendActivityCheck()}))},t.prototype.stopActivityCheck=function(){this.activityTimer&&this.activityTimer.ensureAborted()},t.prototype.buildConnectionCallbacks=function(n){var r=this;return R({},n,{message:function(i){r.resetActivityCheck(),r.emit("message",i)},ping:function(){r.send_event("pusher:pong",{})},activity:function(){r.resetActivityCheck()},error:function(i){r.emit("error",i)},closed:function(){r.abandonConnection(),r.shouldRetry()&&r.retryIn(1e3)}})},t.prototype.buildHandshakeCallbacks=function(n){var r=this;return R({},n,{connected:function(i){r.activityTimeout=Math.min(r.options.activityTimeout,i.activityTimeout,i.connection.activityTimeout||1/0),r.clearUnavailableTimer(),r.setConnection(i.connection),r.socket_id=r.connection.id,r.updateState("connected",{socket_id:r.socket_id})}})},t.prototype.buildErrorCallbacks=function(){var n=this,r=function(i){return function(o){o.error&&n.emit("error",{type:"WebSocketError",error:o.error}),i(o)}};return{tls_only:r(function(){n.usingTLS=!0,n.updateStrategy(),n.retryIn(0)}),refused:r(function(){n.disconnect()}),backoff:r(function(){n.retryIn(1e3)}),retry:r(function(){n.retryIn(0)})}},t.prototype.setConnection=function(n){this.connection=n;for(var r in this.connectionCallbacks)this.connection.bind(r,this.connectionCallbacks[r]);this.resetActivityCheck()},t.prototype.abandonConnection=function(){if(this.connection){this.stopActivityCheck();for(var n in this.connectionCallbacks)this.connection.unbind(n,this.connectionCallbacks[n]);var r=this.connection;return this.connection=null,r}},t.prototype.updateState=function(n,r){var i=this.state;if(this.state=n,i!==n){var o=n;o==="connected"&&(o+=" with new socket ID "+r.socket_id),D.debug("State changed",i+" -> "+o),this.timeline.info({state:n,params:r}),this.emit("state_change",{previous:i,current:n}),this.emit(n,r)}},t.prototype.shouldRetry=function(){return this.state==="connecting"||this.state==="connected"},t}(rt),hn=ln,fn=function(){function e(){this.channels={}}return e.prototype.add=function(t,n){return this.channels[t]||(this.channels[t]=dn(t,n)),this.channels[t]},e.prototype.all=function(){return T(this.channels)},e.prototype.find=function(t){return this.channels[t]},e.prototype.remove=function(t){var n=this.channels[t];return delete this.channels[t],n},e.prototype.disconnect=function(){p(this.channels,function(t){t.disconnect()})},e}(),pn=fn;function dn(e,t){if(e.indexOf("private-encrypted-")===0){if(t.config.nacl)return Z.createEncryptedChannel(e,t,t.config.nacl);var n="Tried to subscribe to a private-encrypted- channel but no nacl implementation available",r=ht.buildLogSuffix("encryptedChannelSupport");throw new Ht(n+". "+r)}else return e.indexOf("private-")===0?Z.createPrivateChannel(e,t):e.indexOf("presence-")===0?Z.createPresenceChannel(e,t):Z.createChannel(e,t)}var gn={createChannels:function(){return new pn},createConnectionManager:function(e,t){return new hn(e,t)},createChannel:function(e,t){return new Ft(e,t)},createPrivateChannel:function(e,t){return new yt(e,t)},createPresenceChannel:function(e,t){return new rn(e,t)},createEncryptedChannel:function(e,t,n){return new cn(e,t,n)},createTimelineSender:function(e,t){return new Be(e,t)},createAuthorizer:function(e,t){return t.authorizer?t.authorizer(e,t):new ze(e,t)},createHandshake:function(e,t){return new De(e,t)},createAssistantToTheTransportManager:function(e,t,n){return new Ie(e,t,n)}},Z=gn,mn=function(){function e(t){this.options=t||{},this.livesLeft=this.options.lives||1/0}return e.prototype.getAssistant=function(t){return Z.createAssistantToTheTransportManager(this,t,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})},e.prototype.isAlive=function(){return this.livesLeft>0},e.prototype.reportDeath=function(){this.livesLeft-=1},e}(),zt=mn,yn=function(){function e(t,n){this.strategies=t,this.loop=!!n.loop,this.failFast=!!n.failFast,this.timeout=n.timeout,this.timeoutLimit=n.timeoutLimit}return e.prototype.isSupported=function(){return H(this.strategies,E.method("isSupported"))},e.prototype.connect=function(t,n){var r=this,i=this.strategies,o=0,s=this.timeout,u=null,b=function(N,J){J?n(null,J):(o=o+1,r.loop&&(o=o%i.length),o<i.length?(s&&(s=s*2,r.timeoutLimit&&(s=Math.min(s,r.timeoutLimit))),u=r.tryStrategy(i[o],t,{timeout:s,failFast:r.failFast},b)):n(!0))};return u=this.tryStrategy(i[o],t,{timeout:s,failFast:this.failFast},b),{abort:function(){u.abort()},forceMinPriority:function(N){t=N,u&&u.forceMinPriority(N)}}},e.prototype.tryStrategy=function(t,n,r,i){var o=null,s=null;return r.timeout>0&&(o=new h(r.timeout,function(){s.abort(),i(!0)})),s=t.connect(n,function(u,b){u&&o&&o.isRunning()&&!r.failFast||(o&&o.ensureAborted(),i(u,b))}),{abort:function(){o&&o.ensureAborted(),s.abort()},forceMinPriority:function(u){s.forceMinPriority(u)}}},e}(),st=yn,vn=function(){function e(t){this.strategies=t}return e.prototype.isSupported=function(){return H(this.strategies,E.method("isSupported"))},e.prototype.connect=function(t,n){return bn(this.strategies,t,function(r,i){return function(o,s){if(i[r].error=o,o){_n(i)&&n(!0);return}O(i,function(u){u.forceMinPriority(s.transport.priority)}),n(null,s)}})},e}(),bt=vn;function bn(e,t,n){var r=U(e,function(i,o,s,u){return i.connect(t,n(o,u))});return{abort:function(){O(r,An)},forceMinPriority:function(i){O(r,function(o){o.forceMinPriority(i)})}}}function _n(e){return tt(e,function(t){return!!t.error})}function An(e){!e.error&&!e.aborted&&(e.abort(),e.aborted=!0)}var xn=function(){function e(t,n,r){this.strategy=t,this.transports=n,this.ttl=r.ttl||1800*1e3,this.usingTLS=r.useTLS,this.timeline=r.timeline}return e.prototype.isSupported=function(){return this.strategy.isSupported()},e.prototype.connect=function(t,n){var r=this.usingTLS,i=Sn(r),o=[this.strategy];if(i&&i.timestamp+this.ttl>=E.now()){var s=this.transports[i.transport];s&&(this.timeline.info({cached:!0,transport:i.transport,latency:i.latency}),o.push(new st([s],{timeout:i.latency*2+1e3,failFast:!0})))}var u=E.now(),b=o.pop().connect(t,function N(J,K){J?(qt(r),o.length>0?(u=E.now(),b=o.pop().connect(t,N)):n(J)):(Tn(r,K.transport.name,E.now()-u),n(null,K))});return{abort:function(){b.abort()},forceMinPriority:function(N){t=N,b&&b.forceMinPriority(N)}}},e}(),wn=xn;function _t(e){return"pusherTransport"+(e?"TLS":"NonTLS")}function Sn(e){var t=j.getLocalStorage();if(t)try{var n=t[_t(e)];if(n)return JSON.parse(n)}catch{qt(e)}return null}function Tn(e,t,n){var r=j.getLocalStorage();if(r)try{r[_t(e)]=lt({timestamp:E.now(),transport:t,latency:n})}catch{}}function qt(e){var t=j.getLocalStorage();if(t)try{delete t[_t(e)]}catch{}}var Cn=function(){function e(t,n){var r=n.delay;this.strategy=t,this.options={delay:r}}return e.prototype.isSupported=function(){return this.strategy.isSupported()},e.prototype.connect=function(t,n){var r=this.strategy,i,o=new h(this.options.delay,function(){i=r.connect(t,n)});return{abort:function(){o.ensureAborted(),i&&i.abort()},forceMinPriority:function(s){t=s,i&&i.forceMinPriority(s)}}},e}(),ft=Cn,kn=function(){function e(t,n,r){this.test=t,this.trueBranch=n,this.falseBranch=r}return e.prototype.isSupported=function(){var t=this.test()?this.trueBranch:this.falseBranch;return t.isSupported()},e.prototype.connect=function(t,n){var r=this.test()?this.trueBranch:this.falseBranch;return r.connect(t,n)},e}(),Bt=kn,Pn=function(){function e(t){this.strategy=t}return e.prototype.isSupported=function(){return this.strategy.isSupported()},e.prototype.connect=function(t,n){var r=this.strategy.connect(t,function(i,o){o&&r.abort(),n(i,o)});return r},e}(),On=Pn;function Wt(e){return function(){return e.isSupported()}}var Ln=function(e,t,n){var r={};function i(Yt,Hr,Ur,Dr,Fr){var te=n(e,Yt,Hr,Ur,Dr,Fr);return r[Yt]=te,te}var o=Object.assign({},t,{hostNonTLS:e.wsHost+":"+e.wsPort,hostTLS:e.wsHost+":"+e.wssPort,httpPath:e.wsPath}),s=R({},o,{useTLS:!0}),u=Object.assign({},t,{hostNonTLS:e.httpHost+":"+e.httpPort,hostTLS:e.httpHost+":"+e.httpsPort,httpPath:e.httpPath}),b={loop:!0,timeout:15e3,timeoutLimit:6e4},N=new zt({lives:2,minPingDelay:1e4,maxPingDelay:e.activityTimeout}),J=new zt({lives:2,minPingDelay:1e4,maxPingDelay:e.activityTimeout}),K=i("ws","ws",3,o,N),Y=i("wss","ws",3,s,N),Ir=i("xhr_streaming","xhr_streaming",1,u,J),Mr=i("xhr_polling","xhr_polling",1,u),Kt=new st([K],b),Nr=new st([Y],b),Qt=new st([Ir],b),Zt=new st([Mr],b),St=new st([new Bt(Wt(Qt),new bt([Qt,new ft(Zt,{delay:4e3})]),Zt)],b),Tt;return t.useTLS?Tt=new bt([Kt,new ft(St,{delay:2e3})]):Tt=new bt([Kt,new ft(Nr,{delay:2e3}),new ft(St,{delay:5e3})]),new wn(new On(new Bt(Wt(K),Tt,St)),r,{ttl:18e5,timeline:t.timeline,useTLS:t.useTLS})},En=Ln,Rn=function(){var e=this;e.timeline.info(e.buildTimelineMessage({transport:e.name+(e.options.useTLS?"s":"")})),e.hooks.isInitialized()?e.changeState("initialized"):e.onClose()},jn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),In=256*1024,Mn=function(e){jn(t,e);function t(n,r,i){var o=e.call(this)||this;return o.hooks=n,o.method=r,o.url=i,o}return t.prototype.start=function(n){var r=this;this.position=0,this.xhr=this.hooks.getRequest(this),this.unloader=function(){r.close()},j.addUnloadListener(this.unloader),this.xhr.open(this.method,this.url,!0),this.xhr.setRequestHeader&&this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.send(n)},t.prototype.close=function(){this.unloader&&(j.removeUnloadListener(this.unloader),this.unloader=null),this.xhr&&(this.hooks.abortRequest(this.xhr),this.xhr=null)},t.prototype.onChunk=function(n,r){for(;;){var i=this.advanceBuffer(r);if(i)this.emit("chunk",{status:n,data:i});else break}this.isBufferTooLong(r)&&this.emit("buffer_too_long")},t.prototype.advanceBuffer=function(n){var r=n.slice(this.position),i=r.indexOf(`
`);return i!==-1?(this.position+=i+1,r.slice(0,i)):null},t.prototype.isBufferTooLong=function(n){return this.position===n.length&&n.length>In},t}(rt),Nn=Mn,At;(function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSED=3]="CLOSED"})(At||(At={}));var ot=At,Hn=1,Un=function(){function e(t,n){this.hooks=t,this.session=Jt(1e3)+"/"+qn(8),this.location=Dn(n),this.readyState=ot.CONNECTING,this.openStream()}return e.prototype.send=function(t){return this.sendRaw(JSON.stringify([t]))},e.prototype.ping=function(){this.hooks.sendHeartbeat(this)},e.prototype.close=function(t,n){this.onClose(t,n,!0)},e.prototype.sendRaw=function(t){if(this.readyState===ot.OPEN)try{return j.createSocketRequest("POST",$t(Fn(this.location,this.session))).start(t),!0}catch{return!1}else return!1},e.prototype.reconnect=function(){this.closeStream(),this.openStream()},e.prototype.onClose=function(t,n,r){this.closeStream(),this.readyState=ot.CLOSED,this.onclose&&this.onclose({code:t,reason:n,wasClean:r})},e.prototype.onChunk=function(t){if(t.status===200){this.readyState===ot.OPEN&&this.onActivity();var n,r=t.data.slice(0,1);switch(r){case"o":n=JSON.parse(t.data.slice(1)||"{}"),this.onOpen(n);break;case"a":n=JSON.parse(t.data.slice(1)||"[]");for(var i=0;i<n.length;i++)this.onEvent(n[i]);break;case"m":n=JSON.parse(t.data.slice(1)||"null"),this.onEvent(n);break;case"h":this.hooks.onHeartbeat(this);break;case"c":n=JSON.parse(t.data.slice(1)||"[]"),this.onClose(n[0],n[1],!0);break}}},e.prototype.onOpen=function(t){this.readyState===ot.CONNECTING?(t&&t.hostname&&(this.location.base=zn(this.location.base,t.hostname)),this.readyState=ot.OPEN,this.onopen&&this.onopen()):this.onClose(1006,"Server lost session",!0)},e.prototype.onEvent=function(t){this.readyState===ot.OPEN&&this.onmessage&&this.onmessage({data:t})},e.prototype.onActivity=function(){this.onactivity&&this.onactivity()},e.prototype.onError=function(t){this.onerror&&this.onerror(t)},e.prototype.openStream=function(){var t=this;this.stream=j.createSocketRequest("POST",$t(this.hooks.getReceiveURL(this.location,this.session))),this.stream.bind("chunk",function(n){t.onChunk(n)}),this.stream.bind("finished",function(n){t.hooks.onFinished(t,n)}),this.stream.bind("buffer_too_long",function(){t.reconnect()});try{this.stream.start()}catch(n){E.defer(function(){t.onError(n),t.onClose(1006,"Could not start streaming",!1)})}},e.prototype.closeStream=function(){this.stream&&(this.stream.unbind_all(),this.stream.close(),this.stream=null)},e}();function Dn(e){var t=/([^\?]*)\/*(\??.*)/.exec(e);return{base:t[1],queryString:t[2]}}function Fn(e,t){return e.base+"/"+t+"/xhr_send"}function $t(e){var t=e.indexOf("?")===-1?"?":"&";return e+t+"t="+ +new Date+"&n="+Hn++}function zn(e,t){var n=/(https?:\/\/)([^\/:]+)((\/|:)?.*)/.exec(e);return n[1]+t+n[3]}function Jt(e){return Math.floor(Math.random()*e)}function qn(e){for(var t=[],n=0;n<e;n++)t.push(Jt(32).toString(32));return t.join("")}var Bn=Un,Wn={getReceiveURL:function(e,t){return e.base+"/"+t+"/xhr_streaming"+e.queryString},onHeartbeat:function(e){e.sendRaw("[]")},sendHeartbeat:function(e){e.sendRaw("[]")},onFinished:function(e,t){e.onClose(1006,"Connection interrupted ("+t+")",!1)}},$n=Wn,Jn={getReceiveURL:function(e,t){return e.base+"/"+t+"/xhr"+e.queryString},onHeartbeat:function(){},sendHeartbeat:function(e){e.sendRaw("[]")},onFinished:function(e,t){t===200?e.reconnect():e.onClose(1006,"Connection interrupted ("+t+")",!1)}},Xn=Jn,Gn={getRequest:function(e){var t=j.getXHRAPI(),n=new t;return n.onreadystatechange=n.onprogress=function(){switch(n.readyState){case 3:n.responseText&&n.responseText.length>0&&e.onChunk(n.status,n.responseText);break;case 4:n.responseText&&n.responseText.length>0&&e.onChunk(n.status,n.responseText),e.emit("finished",n.status),e.close();break}},n},abortRequest:function(e){e.onreadystatechange=null,e.abort()}},Vn=Gn,Kn={createStreamingSocket:function(e){return this.createSocket($n,e)},createPollingSocket:function(e){return this.createSocket(Xn,e)},createSocket:function(e,t){return new Bn(e,t)},createXHR:function(e,t){return this.createRequest(Vn,e,t)},createRequest:function(e,t,n){return new Nn(e,t,n)}},Qn=Kn,Zn={getDefaultStrategy:En,Transports:Mt,transportConnectionInitializer:Rn,HTTPFactory:Qn,setup:function(e){e.ready()},getLocalStorage:function(){},getClientFeatures:function(){return m(C({ws:Mt.ws},function(e){return e.isSupported({})}))},getProtocol:function(){return"http:"},isXHRSupported:function(){return!0},createSocketRequest:function(e,t){if(this.isXHRSupported())return this.HTTPFactory.createXHR(e,t);throw"Cross-origin HTTP requests are not supported"},createXHR:function(){var e=this.getXHRAPI();return new e},createWebSocket:function(e){var t=this.getWebSocketAPI();return new t(e)},addUnloadListener:function(e){},removeUnloadListener:function(e){}},V=Zn,Yn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),tr=function(e){Yn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.isOnline=function(){return!0},t}(rt),er=new tr,nr=function(e,t,n){var r=new Headers;r.set("Content-Type","application/x-www-form-urlencoded");for(var i in this.authOptions.headers)r.set(i,this.authOptions.headers[i]);var o=this.composeQuery(t),s=new Request(this.options.authEndpoint,{headers:r,body:o,credentials:"same-origin",method:"POST"});return fetch(s).then(function(u){var b=u.status;if(b===200)return u.text();throw new mt(200,"Could not get auth info from your auth endpoint, status: "+b)}).then(function(u){var b;try{b=JSON.parse(u)}catch{throw new mt(200,"JSON returned from auth endpoint was invalid, yet status code was 200. Data was: "+u)}n(null,b)}).catch(function(u){n(u,{auth:""})})},rr=nr,ir=function(e,t){return function(n,r){var i="http"+(t?"s":"")+"://",o=i+(e.host||e.options.host)+e.options.path,s=Q(n);o+="/2?"+s,fetch(o).then(function(u){if(u.status!==200)throw"received "+u.status+" from stats.pusher.com";return u.json()}).then(function(u){var b=u.host;b&&(e.host=b)}).catch(function(u){D.debug("TimelineSender Error: ",u)})}},or={name:"xhr",getAgent:ir},sr=or,ar=V.getDefaultStrategy,cr=V.Transports,ur=V.setup,lr=V.getProtocol,hr=V.isXHRSupported,fr=V.getLocalStorage,pr=V.createXHR,dr=V.createWebSocket,gr=V.addUnloadListener,mr=V.removeUnloadListener,yr=V.transportConnectionInitializer,vr=V.createSocketRequest,br=V.HTTPFactory,_r={getDefaultStrategy:ar,Transports:cr,setup:ur,getProtocol:lr,isXHRSupported:hr,getLocalStorage:fr,createXHR:pr,createWebSocket:dr,addUnloadListener:gr,removeUnloadListener:mr,transportConnectionInitializer:yr,createSocketRequest:vr,HTTPFactory:br,TimelineTransport:sr,getAuthorizers:function(){return{ajax:rr}},getWebSocketAPI:function(){return WebSocket},getXHRAPI:function(){return XMLHttpRequest},getNetwork:function(){return er}},j=_r,xt;(function(e){e[e.ERROR=3]="ERROR",e[e.INFO=6]="INFO",e[e.DEBUG=7]="DEBUG"})(xt||(xt={}));var pt=xt,Ar=function(){function e(t,n,r){this.key=t,this.session=n,this.events=[],this.options=r||{},this.sent=0,this.uniqueID=0}return e.prototype.log=function(t,n){t<=this.options.level&&(this.events.push(R({},n,{timestamp:E.now()})),this.options.limit&&this.events.length>this.options.limit&&this.events.shift())},e.prototype.error=function(t){this.log(pt.ERROR,t)},e.prototype.info=function(t){this.log(pt.INFO,t)},e.prototype.debug=function(t){this.log(pt.DEBUG,t)},e.prototype.isEmpty=function(){return this.events.length===0},e.prototype.send=function(t,n){var r=this,i=R({session:this.session,bundle:this.sent+1,key:this.key,lib:"js",version:this.options.version,cluster:this.options.cluster,features:this.options.features,timeline:this.events},this.options.params);return this.events=[],t(i,function(o,s){o||r.sent++,n&&n(o,s)}),!0},e.prototype.generateUniqueID=function(){return this.uniqueID++,this.uniqueID},e}(),xr=Ar,wr=function(){function e(t,n,r,i){this.name=t,this.priority=n,this.transport=r,this.options=i||{}}return e.prototype.isSupported=function(){return this.transport.isSupported({useTLS:this.options.useTLS})},e.prototype.connect=function(t,n){var r=this;if(this.isSupported()){if(this.priority<t)return Xt(new $e,n)}else return Xt(new Ut,n);var i=!1,o=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),s=null,u=function(){o.unbind("initialized",u),o.connect()},b=function(){s=Z.createHandshake(o,function(Y){i=!0,K(),n(null,Y)})},N=function(Y){K(),n(Y)},J=function(){K();var Y;Y=lt(o),n(new Je(Y))},K=function(){o.unbind("initialized",u),o.unbind("open",b),o.unbind("error",N),o.unbind("closed",J)};return o.bind("initialized",u),o.bind("open",b),o.bind("error",N),o.bind("closed",J),o.initialize(),{abort:function(){i||(K(),s?s.close():o.close())},forceMinPriority:function(Y){i||r.priority<Y&&(s?s.close():o.close())}}},e}(),Sr=wr;function Xt(e,t){return E.defer(function(){t(e)}),{abort:function(){},forceMinPriority:function(){}}}var Tr=j.Transports,Cr=function(e,t,n,r,i,o){var s=Tr[n];if(!s)throw new Xe(n);var u=(!e.enabledTransports||G(e.enabledTransports,t)!==-1)&&(!e.disabledTransports||G(e.disabledTransports,t)===-1),b;return u?(i=Object.assign({ignoreNullOrigin:e.ignoreNullOrigin},i),b=new Sr(t,r,o?o.getAssistant(s):s,i)):b=kr,b},kr={isSupported:function(){return!1},connect:function(e,t){var n=E.defer(function(){t(new Ut)});return{abort:function(){n.ensureAborted()},forceMinPriority:function(){}}}};function Pr(e){var t={activityTimeout:e.activityTimeout||F.activityTimeout,authEndpoint:e.authEndpoint||F.authEndpoint,authTransport:e.authTransport||F.authTransport,cluster:e.cluster||F.cluster,httpPath:e.httpPath||F.httpPath,httpPort:e.httpPort||F.httpPort,httpsPort:e.httpsPort||F.httpsPort,pongTimeout:e.pongTimeout||F.pongTimeout,statsHost:e.statsHost||F.stats_host,unavailableTimeout:e.unavailableTimeout||F.unavailableTimeout,wsPath:e.wsPath||F.wsPath,wsPort:e.wsPort||F.wsPort,wssPort:e.wssPort||F.wssPort,enableStats:Rr(e),httpHost:Or(e),useTLS:Er(e),wsHost:Lr(e)};return"auth"in e&&(t.auth=e.auth),"authorizer"in e&&(t.authorizer=e.authorizer),"disabledTransports"in e&&(t.disabledTransports=e.disabledTransports),"enabledTransports"in e&&(t.enabledTransports=e.enabledTransports),"ignoreNullOrigin"in e&&(t.ignoreNullOrigin=e.ignoreNullOrigin),"timelineParams"in e&&(t.timelineParams=e.timelineParams),"nacl"in e&&(t.nacl=e.nacl),t}function Or(e){return e.httpHost?e.httpHost:e.cluster?"sockjs-"+e.cluster+".pusher.com":F.httpHost}function Lr(e){return e.wsHost?e.wsHost:e.cluster?Gt(e.cluster):Gt(F.cluster)}function Gt(e){return"ws-"+e+".pusher.com"}function Er(e){return j.getProtocol()==="https:"?!0:e.forceTLS!==!1}function Rr(e){return"enableStats"in e?e.enableStats:"disableStats"in e?!e.disableStats:!1}var Vt=function(){function e(t,n){var r=this;if(jr(t),n=n||{},!n.cluster&&!(n.wsHost||n.httpHost)){var i=ht.buildLogSuffix("javascriptQuickStart");D.warn("You should always specify a cluster when connecting. "+i)}"disableStats"in n&&D.warn("The disableStats option is deprecated in favor of enableStats"),this.key=t,this.config=Pr(n),this.channels=Z.createChannels(),this.global_emitter=new rt,this.sessionID=Math.floor(Math.random()*1e9),this.timeline=new xr(this.key,this.sessionID,{cluster:this.config.cluster,features:e.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:pt.INFO,version:F.VERSION}),this.config.enableStats&&(this.timelineSender=Z.createTimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline/v2/"+j.TimelineTransport.name}));var o=function(s){return j.getDefaultStrategy(r.config,s,Cr)};this.connection=Z.createConnectionManager(this.key,{getStrategy:o,timeline:this.timeline,activityTimeout:this.config.activityTimeout,pongTimeout:this.config.pongTimeout,unavailableTimeout:this.config.unavailableTimeout,useTLS:!!this.config.useTLS}),this.connection.bind("connected",function(){r.subscribeAll(),r.timelineSender&&r.timelineSender.send(r.connection.isUsingTLS())}),this.connection.bind("message",function(s){var u=s.event,b=u.indexOf("pusher_internal:")===0;if(s.channel){var N=r.channel(s.channel);N&&N.handleEvent(s)}b||r.global_emitter.emit(s.event,s.data)}),this.connection.bind("connecting",function(){r.channels.disconnect()}),this.connection.bind("disconnected",function(){r.channels.disconnect()}),this.connection.bind("error",function(s){D.warn(s)}),e.instances.push(this),this.timeline.info({instances:e.instances.length}),e.isReady&&this.connect()}return e.ready=function(){e.isReady=!0;for(var t=0,n=e.instances.length;t<n;t++)e.instances[t].connect()},e.getClientFeatures=function(){return m(C({ws:j.Transports.ws},function(t){return t.isSupported({})}))},e.prototype.channel=function(t){return this.channels.find(t)},e.prototype.allChannels=function(){return this.channels.all()},e.prototype.connect=function(){if(this.connection.connect(),this.timelineSender&&!this.timelineSenderTimer){var t=this.connection.isUsingTLS(),n=this.timelineSender;this.timelineSenderTimer=new A(6e4,function(){n.send(t)})}},e.prototype.disconnect=function(){this.connection.disconnect(),this.timelineSenderTimer&&(this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null)},e.prototype.bind=function(t,n,r){return this.global_emitter.bind(t,n,r),this},e.prototype.unbind=function(t,n,r){return this.global_emitter.unbind(t,n,r),this},e.prototype.bind_global=function(t){return this.global_emitter.bind_global(t),this},e.prototype.unbind_global=function(t){return this.global_emitter.unbind_global(t),this},e.prototype.unbind_all=function(t){return this.global_emitter.unbind_all(),this},e.prototype.subscribeAll=function(){var t;for(t in this.channels.channels)this.channels.channels.hasOwnProperty(t)&&this.subscribe(t)},e.prototype.subscribe=function(t){var n=this.channels.add(t,this);return n.subscriptionPending&&n.subscriptionCancelled?n.reinstateSubscription():!n.subscriptionPending&&this.connection.state==="connected"&&n.subscribe(),n},e.prototype.unsubscribe=function(t){var n=this.channels.find(t);n&&n.subscriptionPending?n.cancelSubscription():(n=this.channels.remove(t),n&&n.subscribed&&n.unsubscribe())},e.prototype.send_event=function(t,n,r){return this.connection.send_event(t,n,r)},e.prototype.shouldUseTLS=function(){return this.config.useTLS},e.instances=[],e.isReady=!1,e.logToConsole=!1,e.Runtime=j,e.ScriptReceivers=j.ScriptReceivers,e.DependenciesReceivers=j.DependenciesReceivers,e.auth_callbacks=j.auth_callbacks,e}(),wt=g.default=Vt;function jr(e){if(e==null)throw"You must pass your app key when you instantiate Pusher."}j.setup(Vt)}])})})(Ot);var re=Ot.exports,ie=re;const oe=kt(ie),at=new Map;async function se(l,_,d){const g=l.get(_);if(!g)throw new Error("Channel not found");const{origin:y,token:f}=g,M=(await(await fetch(`${y}/api/pusher/auth`,{method:"POST",body:JSON.stringify({socketId:d,channels:[_]}),headers:{Authorization:f}})).json())[_];if(!M)throw new Error("Failed to authenticate channel");return M}function ae(l,_){const d=`${l}:${_}`,g=at.get(d);if(g)return g;const y=new Map,f=new Map,w={pusher:new oe(l,{cluster:_,authorizer:M=>({authorize:(z,L)=>{se(y,M.name,z).then(k=>{L(null,k)}).catch(k=>{L(k,null)})}})}),channelInfoMap:y,channelSubscriptions:f};return at.set(d,w),w}function ce(){return Math.random().toString(36).slice(2,15)}function ue(l){const{appKey:_,cluster:d,origin:g,token:y,channel:f}=JSON.parse(l.name),c=ce(),{pusher:w,channelInfoMap:M,channelSubscriptions:z}=ae(_,d);M.set(f,{origin:g,token:y});const L=w.subscribe(f);let k=!1;const x=()=>{if(k)return;let P=z.get(f);P||(P=new Set,z.set(f,P)),P.add(c),l.postMessage({type:"setup",subscribed:!0,pingId:c}),k=!0};L.bind("pusher:subscription_succeeded",()=>{x()}),L.subscribed&&x();let S=!1;l.onDisconnect.addListener(()=>{S=!0,Lt(c)}),L.bind_global((P,v)=>{S||l.postMessage({type:"pusher-event",event:P,channel:f,data:v})}),setTimeout(()=>{k||(k=!0,l.postMessage({type:"setup",subscribed:!1}),Lt(c))},2e3)}function le(){setTimeout(()=>{for(const[l,{channelSubscriptions:_,pusher:d}]of at.entries())if(_.size===0){try{d.disconnect()}catch{}at.delete(l)}},1)}function Lt(l){for(const{channelSubscriptions:_,channelInfoMap:d,pusher:g}of at.values())for(const[y,f]of _.entries())if(f.has(l)&&(f.delete(l),f.size===0)){d.delete(y),_.delete(y);try{g.unsubscribe(y)}catch{}}le()}const ut=new Map;function he(l,_,d,g){let y=ut.get(l);y||(y={},ut.set(l,y)),y[_]={url:d,headers:g}}function fe(l,_){const d=_.map(y=>y.toLowerCase()),g=ut.get(l);if(g)return Object.fromEntries(Object.values(g).map(({url:y,headers:f})=>[y,Object.fromEntries(Object.entries(f).map(([c,w])=>[c.toLowerCase(),w]).filter(([c])=>d.includes(c)))]))}q.webRequest.onHeadersReceived.addListener(l=>{if(!l.url.startsWith("https://vercel.live")&&l.tabId&&l.responseHeaders){const _={};for(const d of l.responseHeaders)d.name&&d.value&&(_[d.name]=d.value);he(l.tabId,l.frameId,l.url,_)}},{urls:["<all_urls>"],types:["main_frame","sub_frame"]},["responseHeaders"]),q.tabs.onRemoved.addListener(l=>{ut.delete(l)}),ne(l=>{q.runtime.onMessage.addListener(async(_,d)=>await l(_,{sender:d}))})({takeScreenshot:async()=>({dataURI:await q.tabs.captureVisibleTab(void 0,{format:"png"})}),checkAuth:async()=>{try{const l=await fetch("https://vercel.com/api/extension-auth");return l.status!==200?void 0:await l.json()}catch{return}},checkDomainOwner:async({domain:l})=>{try{const _=new URLSearchParams({domain:l});return(await fetch(`https://vercel.com/api/live/check-domain-owner?${_.toString()}`)).ok}catch{return!1}},proxyFetch:async({url:l,init:_,requestId:d,origin:g},{sender:y})=>{var f;try{const c=(f=y.tab)==null?void 0:f.id;c&&q.tabs.sendMessage(c,{action:"proxy-fetch-ack",requestId:d});const w=await fetch(new URL(l,g),_),M=await w.blob(),z=await ge(M);return{type:"proxy-fetch-response",requestId:d,body:z,status:w.status,statusText:w.statusText,headers:Array.from(w.headers.entries())}}catch{return{type:"proxy-fetch-response",requestId:d,body:null,status:500,statusText:"Internal Server Error",headers:[]}}},extensionAuth:async({origin:l,token:_})=>{try{const d=await fetch(`${l}/api/feedback/auth/extension-validate`,{headers:{authorization:_}});return d.ok?{success:await d.text()==="OK"}:{success:!1}}catch{return{success:!1}}},getUserSettings:async()=>{const{userSettings:l}=await q.storage.sync.get("userSettings");return l},updateUserSettings:async({settings:l})=>{const{userSettings:_}=await q.storage.sync.get("userSettings"),d={..._,...l};return await q.storage.sync.set({userSettings:d}),d},getTapHeaders:async({keys:l},{sender:_})=>{var g;const d=(g=_.tab)==null?void 0:g.id;return d?fe(d,l):{}}}).register(),q.runtime.onConnect.addListener(l=>{ue(l)}),q.alarms.onAlarm.addListener(l=>{l.name==="sync-domains"&&(async()=>{const d=new Set,g=async f=>{const c=await de(f);for(const w of c)d.add(w)};await Promise.all([g(null),pe().then(f=>Promise.all(f.map(c=>g(c))))]);const y=(await q.storage.local.get(["domains"])).domains??{};for(const f in y)y[f]&&++y[f]>=5&&delete y[f];for(const f of d)y[f]=0;await q.storage.local.set({domains:y})})()}),q.runtime.onInstalled.addListener(()=>{q.alarms.create("sync-domains",{delayInMinutes:0,periodInMinutes:60})});const pe=async()=>{const l=await fetch("https://vercel.com/api/v2/teams?limit=100");return l.ok?(await l.json()).teams.map(d=>d.id):[]},de=async l=>{const _=new URLSearchParams;l&&_.set("teamId",l);const d=await fetch(`https://vercel.com/api/live/production-domains?${_.toString()}`);return d.ok?(await d.json()).domains:[]};q.action.onClicked.addListener(l=>{l.id&&q.tabs.sendMessage(l.id,{action:"extension-clicked"})});function ge(l){return new Promise(_=>{const d=new FileReader,g=()=>{_(d.result),d.removeEventListener("load",g)};d.addEventListener("load",g),d.readAsDataURL(l)})}})();
