// ============================================
// NIAGAOS Database Client Export
// ============================================
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// CORE ENTITIES
// ============================================

model Tenant {
  id        String   @id @default(cuid())
  slug      String   @unique
  name      String
  vertical  Vertical
  tier      Tier     @default(FREE)
  config    Json     @default("{}")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  users     User[]
  merchants Merchant[]
  startups  Startup[]
  agents    Agent[]

  @@map("tenants")
}

model User {
  id        String   @id @default(cuid())
  tenantId  String
  email     String
  name      String
  role      UserRole @default(CUSTOMER)
  avatarUrl String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  tenant   Tenant  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  orders   Order[]
  memories AgentMemory[]

  @@unique([tenantId, email])
  @@map("users")
}

// ============================================
// F&B VERTICAL
// ============================================

model Merchant {
  id       String @id @default(cuid())
  tenantId String
  name     String
  slug     String

  // Settings
  currency        String  @default("USD")
  taxRate         Decimal @default(0)
  orderPrefix     String  @default("ORD")
  kioskEnabled    Boolean @default(true)
  whatsappEnabled Boolean @default(false)
  theme           Json    @default("{}")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  tenant    Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  menuItems MenuItem[]
  orders    Order[]

  @@unique([tenantId, slug])
  @@map("merchants")
}

model MenuItem {
  id          String  @id @default(cuid())
  merchantId  String
  name        String
  description String?
  price       Decimal
  category    String
  image       String?
  available   Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  merchant   Merchant    @relation(fields: [merchantId], references: [id], onDelete: Cascade)
  orderItems OrderItem[]

  @@map("menu_items")
}

model Order {
  id         String      @id @default(cuid())
  merchantId String
  userId     String?
  status     OrderStatus @default(PENDING)
  total      Decimal     @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  merchant Merchant    @relation(fields: [merchantId], references: [id], onDelete: Cascade)
  user     User?       @relation(fields: [userId], references: [id])
  items    OrderItem[]

  @@map("orders")
}

model OrderItem {
  id         String @id @default(cuid())
  orderId    String
  menuItemId String
  name       String
  quantity   Int    @default(1)
  price      Decimal
  modifiers  Json   @default("[]")

  // Relations
  order    Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  menuItem MenuItem @relation(fields: [menuItemId], references: [id])

  @@map("order_items")
}

// ============================================
// STARTUP VERTICAL
// ============================================

model Startup {
  id       String       @id @default(cuid())
  tenantId String
  name     String
  stage    StartupStage @default(IDEA)
  mrr      Decimal      @default(0)
  runway   Int          @default(0) // months
  teamSize Int          @default(1)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  tenant    Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  ideas     Idea[]
  campaigns Campaign[]

  @@map("startups")
}

model Idea {
  id          String     @id @default(cuid())
  startupId   String
  title       String
  description String
  analysis    Json?
  status      IdeaStatus @default(DRAFT)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  startup Startup @relation(fields: [startupId], references: [id], onDelete: Cascade)

  @@map("ideas")
}

model Campaign {
  id        String         @id @default(cuid())
  startupId String
  name      String
  type      CampaignType
  status    CampaignStatus @default(DRAFT)
  content   Json           @default("{}")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  startup Startup @relation(fields: [startupId], references: [id], onDelete: Cascade)

  @@map("campaigns")
}

// ============================================
// AGENT VERTICAL
// ============================================

model Agent {
  id       String @id @default(cuid())
  tenantId String?
  name     String @unique
  soul     Json   @default("{}")
  identity Json   @default("{}")
  skills   Json   @default("[]")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  tenant   Tenant?       @relation(fields: [tenantId], references: [id])
  memories AgentMemory[]

  @@map("agents")
}

model AgentMemory {
  id      String     @id @default(cuid())
  agentId String
  userId  String?
  type    MemoryType
  content String
  date    String

  createdAt DateTime @default(now())

  // Relations
  agent Agent @relation(fields: [agentId], references: [id], onDelete: Cascade)
  user  User? @relation(fields: [userId], references: [id])

  @@map("agent_memories")
}

// ============================================
// ENUMS
// ============================================

enum Vertical {
  FNB
  STARTUP
  AGENT
}

enum Tier {
  FREE
  PRO
  ENTERPRISE
}

enum UserRole {
  ADMIN
  OWNER
  STAFF
  CUSTOMER
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PREPARING
  READY
  COMPLETED
  CANCELLED
}

enum StartupStage {
  IDEA
  MVP
  SEED
  SERIES_A
  GROWTH
}

enum IdeaStatus {
  DRAFT
  VALIDATED
  REJECTED
}

enum CampaignType {
  EMAIL
  SOCIAL
  CONTENT
  ADS
}

enum CampaignStatus {
  DRAFT
  ACTIVE
  PAUSED
  COMPLETED
}

enum MemoryType {
  DAILY
  LONGTERM
}
